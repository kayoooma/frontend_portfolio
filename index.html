<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Отключение авто-перевода браузеров -->
  <meta name="google" content="notranslate">
  <meta name="robots" content="notranslate">
  
  <!-- Основные мета-теги -->
  <title>Komil Sultonov — WOW Portfolio | Веб-разработчик</title>
  <meta name="description" content="Komil Sultonov - профессиональная веб-разработка. Создаю современные сайты с стекломорфизмом, неоном и 3D-графикой. Закажите продающий сайт!" />
  <meta name="keywords" content="веб-разработка, стекломорфизм, 3D графика, создание сайтов, лендинг, портфолио, Komil Sultonov" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="Komil Sultonov" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="Komil Sultonov - Современная веб-разработка">
  <meta property="og:description" content="Создаю уникальные сайты с стекломорфизмом, неоном и 3D-графикой. Закажите продающий сайт!">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Komil Sultonov Portfolio">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Komil Sultonov - Современная веб-разработка">
  <meta name="twitter:description" content="Создаю уникальные сайты с стекломорфизмом, неоном и 3D-графикой.">
  
  <!-- Предзагрузка критических ресурсов -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="dns-prefetch" href="https://s.wordpress.com">
  
  <!-- Шрифты с оптимизацией загрузки -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Orbitron:wght@600;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
  </noscript>
  
  <!-- Иконки -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M12 2l2.6 6.4L21 9.2l-5 4.2 1.7 6.6L12 16.8 6.3 20l1.7-6.6-5-4.2 6.4-.8L12 2z' fill='%2300f5ff' stroke='%237a5cff' stroke-width='0.5'/></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M12 2l2.6 6.4L21 9.2l-5 4.2 1.7 6.6L12 16.8 6.3 20l1.7-6.6-5-4.2 6.4-.8L12 2z' fill='%2300f5ff' stroke='%237a5cff' stroke-width='0.5'/></svg>">
  
  <!-- Структурированные данные -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Komil Sultonov",
    "jobTitle": "Web Developer",
    "url": "https://komilsultonov.com",
    "sameAs": [
      "https://t.me/Ka_yooo_ma"
    ],
    "worksFor": {
      "@type": "Organization",
      "name": "Freelance"
    },
    "knowsAbout": ["Web Development", "UI/UX Design", "3D Graphics", "JavaScript", "CSS", "HTML"]
  }
  </script>
  
  <style>
    /* === КРИТИЧЕСКИЙ CSS === */
    :root{
      --bg-1: #0a0a12;
      --bg-2: #0d0a1f;
      --neon-1: #00f5ff;
      --neon-2: #7a5cff;
      --neon-3: #ff3df5;
      --glass-bg: rgba(255,255,255,0.06);
      --glass-brd: rgba(255,255,255,0.20);
      --txt: #e9f1ff;
      --muted: #a9b3c7;
      --shadow-neon: 0 0 12px rgba(0,245,255,.55), 0 0 32px rgba(122,92,255,.45), 0 0 56px rgba(255,61,245,.35);
    }
    
    /* Базовые сбросы и настройки */
    *{box-sizing:border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0; 
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--txt); 
      background: radial-gradient(1200px 800px at 20% -10%, rgba(122,92,255,.20), transparent 60%), 
                  radial-gradient(900px 700px at 120% 20%, rgba(0,245,255,.20), transparent 60%), 
                  linear-gradient(180deg, var(--bg-2), var(--bg-1));
      overflow-x:hidden;
      line-height: 1.6;
    }

    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0a12, #0d0a1f);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }
    
    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .loading-logo {
      font-size: 4rem;
      margin-bottom: 2rem;
      animation: pulse 2s infinite;
    }
    
    .loading-text {
      font-family: Orbitron, sans-serif;
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(45deg, #00f5ff, #7a5cff, #ff3df5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .loading-bar {
      width: 300px;
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .loading-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: #00f5ff;
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 15px #00f5ff, 0 0 30px rgba(0, 245, 255, 0.5);
      /* Fallback для оффлайн режима */
      animation: progressPulse 2s ease-in-out infinite;
    }
    
    @keyframes progressPulse {
      0%, 100% { 
        opacity: 1;
        box-shadow: 0 0 15px #00f5ff, 0 0 30px rgba(0, 245, 255, 0.5);
      }
      50% { 
        opacity: 0.8;
        box-shadow: 0 0 20px #00f5ff, 0 0 40px rgba(0, 245, 255, 0.7);
      }
    }
    
    .loading-stats {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: var(--muted);
      text-align: center;
    }

    /* 3D canvas behind everything */
    #bg3d{position:fixed; inset:0; z-index:-1; display:block}

    /* Animated glow orbs (kept subtle above 3D) */
    .orb{position:fixed; inset:auto; width:42vmax; height:42vmax; filter:blur(60px); opacity:.25; mix-blend-mode:screen; pointer-events:none; z-index:0}
    .orb:nth-child(1){top:-10vmax; left:-10vmax; background:radial-gradient(circle at 30% 30%, var(--neon-2), transparent 60%); animation: drift1 26s ease-in-out infinite alternate}
    .orb:nth-child(2){bottom:-12vmax; right:-16vmax; background:radial-gradient(circle at 60% 60%, var(--neon-1), transparent 60%); animation: drift2 30s ease-in-out infinite alternate}
    .orb:nth-child(3){top:30vh; left:50vw; background:radial-gradient(circle at 50% 50%, var(--neon-3), transparent 60%); animation: drift3 38s ease-in-out infinite alternate}
    @keyframes drift1{to{transform:translate(8vmax,6vmax) rotate(20deg) scale(1.1)}}
    @keyframes drift2{to{transform:translate(-6vmax,-4vmax) rotate(-16deg) scale(1.05)}}
    @keyframes drift3{to{transform:translate(-10vmax,4vmax) rotate(12deg) scale(1.12)}}

    /* Header - FIXED */
    header{
      position:fixed;
      top:0;
      width:100%;
      z-index:1000;
      padding:12px clamp(16px, 4vw, 48px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      backdrop-filter:blur(10px) saturate(160%);
      -webkit-backdrop-filter:blur(10px) saturate(160%);
      background:linear-gradient(180deg, rgba(12,10,30,.85), rgba(12,10,30,.45));
      border-bottom:1px solid rgba(255,255,255,.06)
    }
    
    /* Дополнительные стили для предотвращения наложения текста */
    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
      flex: 1;
      min-width: 0;
      z-index: 1002;
      position: relative;
    }
    
    .brand-link {
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
      color: inherit;
      cursor: pointer;
      transition: opacity 0.3s ease;
      min-width: 0;
      flex: 1;
      z-index: 1003;
      position: relative;
    }
    
    .brand-link:hover {
      opacity: 0.8;
    }
    
    .badge{
      width:42px; 
      height:42px; 
      border-radius:14px; 
      background: linear-gradient(135deg, rgba(0,245,255,.2), rgba(122,92,255,.2));
      box-shadow: 0 0 25px rgba(0,245,255,.7), 0 0 45px rgba(122,92,255,.5), 0 0 65px rgba(255,61,245,.4);
      display:grid; 
      place-items:center; 
      backdrop-filter: blur(8px) saturate(140%); 
      -webkit-backdrop-filter: blur(8px) saturate(140%);
      flex-shrink: 0;
      z-index: 1004;
      position: relative;
    }
    
    .badge svg{width:24px; height:24px}
    
    .title{
      font-family: Orbitron, Inter, sans-serif; 
      letter-spacing:.02em; 
      font-weight:800; 
      font-size: clamp(16px, 2.6vw, 26px); 
      text-transform:uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: min(100%, 300px);
      min-width: 0;
      z-index: 1003;
      position: relative;
    }
    
    .title .short-text {
      display: none;
    }

    /* Navigation - ИСПРАВЛЕНО */
    nav{
      display:flex; 
      gap:8px; 
      align-items:center; 
      flex-wrap: nowrap;
    }
    
    .nav-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: nowrap;
      min-width: max-content;
      flex-shrink: 0;
    }
    
    .pill{ 
      --c: var(--neon-1); 
      padding:9px 12px; 
      border-radius:999px; 
      border:1px solid var(--glass-brd); 
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06)); 
      color:var(--txt); 
      backdrop-filter: blur(10px) saturate(150%); 
      -webkit-backdrop-filter: blur(10px) saturate(150%); 
      text-decoration:none; 
      font-weight:600; 
      font-size:13px; 
      box-shadow:0 0 0 0 rgba(0,0,0,0); 
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease; 
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .pill:hover{ transform: translateY(-1px); box-shadow: 0 0 16px var(--c); border-color: rgba(255,255,255,.4) }
    .pill.active{ box-shadow: 0 0 12px var(--c); }
    .icon-pill{ 
      width:42px; 
      height:42px; 
      display:grid; 
      place-items:center;
      padding:0; 
      font-size:22px; 
    }
    
    /* Кнопка языка - ИСПРАВЛЕНА */
    .lang-pill {
      font-family: Inter, sans-serif;
      font-weight: 700;
      font-size: 12px;
      position: relative;
      min-width: 42px;
    }
    
    .lang-code {
      display: block;
      line-height: 1;
    }
    
    .lang-pill::after {
      content: "";
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #00f5ff;
      box-shadow: 0 0 8px #00f5ff;
      opacity: 1;
    }

    /* Strong CTA order button */
    .order-btn{ 
      --c: var(--neon-3); 
      padding:12px 16px; 
      font-weight:900; 
      letter-spacing:.02em; 
      background:linear-gradient(135deg, rgba(255,61,245,.8), rgba(122,92,255,.8)); 
      box-shadow:0 0 22px rgba(255,61,245,.65), 0 0 32px rgba(122,92,255,.45); 
      border:1px solid rgba(255,255,255,.35) 
    }
    
    .order-btn:hover{ transform:translateY(-1px) scale(1.02); box-shadow:0 0 28px rgba(255,61,245,.85), 0 0 44px rgba(122,92,255,.65) }
    
    @keyframes pulse{0%,100%{filter:drop-shadow(0 0 10px rgba(255,61,245,.6))}50%{filter:drop-shadow(0 0 18px rgba(122,92,255,.8))}}
    
    .order-btn{ animation:pulse 2.6s ease-in-out infinite }

    /* Mobile menu button */
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--txt);
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      flex-shrink: 0;
    }

    /* Hero - adjusted for fixed header */
    .hero{
      position:relative;
      z-index:1;
      display:grid;
      place-items:center;
      padding: clamp(100px, 12vw, 160px) 24px 24px;
      min-height: 100vh;
    }
    
    .hero-inner{max-width:1200px; width:100%; display:grid; grid-template-columns: 1fr; gap:14px; text-align:center}
    .headline{font-family: Orbitron, Inter, sans-serif; font-weight:800; letter-spacing:.02em; font-size: clamp(36px, 7vw, 72px); line-height:1.05; margin:0 auto; text-shadow: 0 0 12px rgba(0,245,255,.6), 0 0 36px rgba(122,92,255,.45)}
    .sub{max-width:820px; margin:0 auto; color:#f3f7ff; font-size: clamp(14px, 2.1vw, 18px); text-shadow: 0 2px 12px rgba(0,0,0,.55); background: linear-gradient(180deg, rgba(12,10,30,.42), rgba(12,10,30,.22)); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:12px 14px; backdrop-filter: blur(10px) saturate(160%); -webkit-backdrop-filter: blur(10px) saturate(160%); }
    .cta{margin-top:10px; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap}
    .cta .btn{ --c: var(--neon-2); padding:12px 16px; border-radius:14px; border:1px solid var(--glass-brd); background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); color:var(--txt); backdrop-filter: blur(12px) saturate(160%); -webkit-backdrop-filter: blur(12px) saturate(160%); font-weight:700; text-decoration:none; display:inline-flex; align-items:center; gap:10px; box-shadow: var(--shadow-neon); transition: transform .25s ease, box-shadow .25s ease, background .25s ease; }
    .cta .btn:hover{ transform: translateY(-2px) scale(1.02); box-shadow: 0 0 24px var(--c), 0 0 48px rgba(0,0,0,.25)}
    .btn-icon { transition: transform 0.3s ease; }
    .btn:hover .btn-icon { transform: translateX(3px) scale(1.1); }

    /* Controls */
    .controls{
      position:sticky;
      top:64px;
      z-index:3;
      padding:8px clamp(16px,4vw,48px);
      backdrop-filter: blur(8px) saturate(160%);
      -webkit-backdrop-filter: blur(8px) saturate(160%);
      background: linear-gradient(180deg, rgba(12,10,30,.52), rgba(12,10,30,.22));
      border-bottom:1px solid rgba(255,255,255,.06)
    }
    
    .controls-inner{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center}
    .search{flex:1 1 320px; max-width:720px; position:relative}
    .search input{width:100%; padding:14px 44px 14px 14px; border-radius:14px; border:1px solid var(--glass-brd); background:var(--glass-bg); color:var(--txt); outline:none; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);}    
    .search .hint{position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:12px; color:var(--muted)}

    /* Grid */
    .wrap{max-width:1200px; margin: 22px auto; padding: 0 clamp(16px, 4vw, 48px)}
    .grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:18px}

    .card{ position:relative; overflow:hidden; border-radius:20px; border:1px solid var(--glass-brd); background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); backdrop-filter: blur(16px) saturate(160%); -webkit-backdrop-filter: blur(16px) saturate(160%); transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease; cursor:pointer; min-height:260px; perspective: 1000px; }
    .card:hover{ transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0,0,0,.35), 0 0 28px rgba(122,92,255,.35)}
    .thumb{position:relative; height:150px; overflow:hidden; border-bottom:1px solid rgba(255,255,255,.06)}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block; filter:saturate(120%) contrast(105%); transition: transform 0.5s ease, filter 0.5s ease;}
    .card:hover .thumb img { transform: scale(1.05); filter: saturate(140%) contrast(110%); }
    .card::before{ content:""; position:absolute; inset:-2px; pointer-events:none; background: radial-gradient(600px 200px at var(--mx,50%) var(--my,0%), rgba(0,245,255,.25), transparent 40%), radial-gradient(600px 200px at calc(var(--mx,50%) - 20%) calc(var(--my,0%) + 20%), rgba(255,61,245,.20), transparent 40%); filter: blur(30px); opacity:.7; transition: opacity .2s ease }
    .card:hover::before{opacity:1}
    .card .body{padding:14px; display:flex; flex-direction:column; height:calc(100% - 0px)}
    .card h3{margin:0 0 6px; font-size:18px; letter-spacing:.01em}
    .desc{color:var(--muted); font-size:13.5px; line-height:1.45}
    .tags{display:flex; gap:6px; flex-wrap:wrap; margin-top:10px}
    .tag{font-size:11.5px; padding:6px 8px; border-radius:999px; border:1px solid var(--glass-brd); background:rgba(255,255,255,.06)}
    .goto{display:flex; justify-content:flex-end; margin-top:auto}
    .goto a{--c: var(--neon-1); text-decoration:none; color:var(--txt); font-weight:800; border:1px solid var(--glass-brd); border-radius:12px; padding:10px 12px; background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06)); box-shadow:0 0 0 rgba(0,0,0,0); transition: box-shadow .25s ease, transform .25s ease}
    .goto a:hover{box-shadow:0 0 14px var(--c); transform: translateY(-1px)}

    footer{opacity:.95; color:var(--muted); text-align:center; padding:40px 16px}
    footer a{ color:#fff; font-weight:700; text-decoration:none; border-bottom:1px dashed rgba(255,255,255,.65) }
    footer a:hover{ filter: drop-shadow(0 0 8px rgba(255,255,255,.6)) }

    /* Cursor glow - УЛУЧШЕННЫЙ */
    .cursor{ 
      position:fixed; 
      pointer-events:none; 
      width:40vmax; 
      height:40vmax; 
      left:0; 
      top:0; 
      transform:translate(-50%,-50%); 
      z-index:2; 
      mix-blend-mode:overlay; 
      filter: blur(40px); 
      opacity:.55; 
      background: radial-gradient(
        circle at center,
        var(--neon-1) 0%,
        var(--neon-2) 30%,
        var(--neon-3) 60%,
        transparent 80%
      );
      animation: pulseCursor 4s ease-in-out infinite;
    }
    
    @keyframes pulseCursor {
      0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.2); }
    }

    /* Modal */
    .modal{position:fixed; inset:0; z-index:10; display:none; align-items:center; justify-content:center; background:radial-gradient(60vmax 60vmax at 50% 10%, rgba(122,92,255,.18), rgba(0,0,0,.65)); backdrop-filter: blur(6px)}
    .modal.open{display:flex}
    .modal .box{min-width:280px; max-width:520px; width:clamp(280px, 60vw, 500px); padding:16px; border-radius:18px; border:1px solid var(--glass-brd); background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); box-shadow: var(--shadow-neon)}
    .modal .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .modal .btn{flex:1 1 100px}

    /* Calculator Modal */
    .calculator-modal .box {
      max-width: 600px;
      min-width: 320px;
    }
    
    .calculator-step {
      display: none;
    }
    
    .calculator-step.active {
      display: block;
    }
    
    .calculator-progress {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      position: relative;
    }
    
    .calculator-progress:before {
      content: '';
      position: absolute;
      top: 14px;
      left: 0;
      right: 0;
      height: 2px;
      background: rgba(0, 245, 255, 0.3);
      z-index: 1;
    }
    
    .progress-step {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(0, 245, 255, 0.1);
      border: 2px solid #00f5ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      position: relative;
      z-index: 2;
      color: #00f5ff;
      transition: all 0.3s ease;
      box-shadow: 0 0 5px rgba(0, 245, 255, 0.5);
    }
    
    .progress-step.active {
      background: #00f5ff;
      border-color: #00f5ff;
      color: #0a0a12;
      box-shadow: 0 0 10px #00f5ff, 0 0 20px rgba(0, 245, 255, 0.7);
    }
    
    .calculator-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    
    .calculator-option {
      padding: 12px;
      border: 1px solid var(--glass-brd);
      border-radius: 12px;
      background: var(--glass-bg);
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .calculator-option:hover {
      border-color: var(--neon-1);
      transform: translateY(-2px);
    }
    
    .calculator-option.selected {
      border-color: var(--neon-2);
      background: rgba(122, 92, 255, 0.1);
      box-shadow: 0 0 12px rgba(122, 92, 255, 0.3);
    }
    
    .calculator-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    
    .calculator-price {
      text-align: center;
      font-size: 24px;
      font-weight: 800;
      margin: 20px 0;
      color: var(--neon-1);
      text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
    }
    
    .calculator-summary {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
    }
    
    .calculator-summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .calculator-summary-item:last-child {
      margin-bottom: 0;
      border-top: 1px solid var(--glass-brd);
      padding-top: 8px;
      font-weight: 700;
      font-size: 16px;
    }

    /* Design panel */
    .panel{position:fixed; right:16px; bottom:16px; z-index:5; display:none}
    .panel.open{display:block}
    .panel .content{min-width:300px; padding:14px; border-radius:16px; border:1px solid var(--glass-brd); background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); backdrop-filter: blur(12px) saturate(160%); -webkit-backdrop-filter: blur(12px) saturate(160%); box-shadow: var(--shadow-neon)}
    .section-title{font-weight:800; font-size:14px; opacity:.9}
    .theme-grid{display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; margin-top:10px}
    .theme{display:flex; align-items:center; gap:10px; padding:10px; border-radius:12px; border:1px solid var(--glass-brd); background:rgba(255,255,255,.06); cursor:pointer}
    .sw{width:22px; height:22px; border-radius:6px; border:1px solid rgba(255,255,255,.3)}
    .panel .row{display:flex; gap:8px; justify-content:flex-end; margin-top:12px; align-items:center}
    .lock{display:flex; align-items:center; gap:8px; font-size:12.5px; color:var(--muted)}

    /* Floating buttons */
    .audio-pill{position:fixed; left:16px; bottom:16px; z-index:6}
    
    /* Scroll to top button - NEW */
    .scroll-top{
      position:fixed;
      right:16px;
      bottom:80px;
      z-index:6;
      width:48px;
      height:48px;
      border-radius:50%;
      display:grid;
      place-items:center;
      font-size:20px;
      border:1px solid var(--glass-brd);
      background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      box-shadow: var(--shadow-neon);
      cursor:pointer;
      opacity:0;
      visibility:hidden;
      transform:translateY(20px);
      transition:all 0.3s ease;
    }
    
    .scroll-top.visible{
      opacity:1;
      visibility:visible;
      transform:translateY(0);
    }
    
    .scroll-top:hover{
      transform:translateY(-2px);
      box-shadow:0 0 20px var(--neon-2);
    }

    .fab{ position:fixed; right:16px; bottom:16px; z-index:6; width:48px; height:48px; border-radius:999px; display:grid; place-items:center; font-size:22px; border:1px solid var(--glass-brd); background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06)); box-shadow: var(--shadow-neon); cursor:pointer }
    .fab:hover{ transform: translateY(-1px); box-shadow:0 0 20px var(--neon-2) }

    /* Anchor targets spacing so sticky header doesn't overlap */
    section, .controls{scroll-margin-top:96px}

    /* Benefits section - ДОБАВЛЕН ПЕРЕВОД */
    .benefits-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap:18px;
      margin:40px 0;
    }
    
    .benefit-card{
      padding:20px;
      border-radius:16px;
      border:1px solid var(--glass-brd);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      backdrop-filter: blur(12px) saturate(160%);
      text-align:center;
      transition:transform 0.3s ease;
    }
    
    .benefit-card:hover{
      transform:translateY(-5px);
    }
    
    .benefit-icon{
      font-size:40px;
      margin-bottom:15px;
      display:block;
    }
    
    .benefit-card h3{
      margin:0 0 12px 0;
      color:var(--neon-1);
      font-size:18px;
    }
    
    .benefit-card p{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.5;
    }

    /* About section improvements */
    .about-highlight{
      margin:20px 0;
      padding:16px;
      background: rgba(255,255,255,0.05);
      border-radius:12px;
      border-left:3px solid var(--neon-2);
    }
    
    .about-highlight h4{
      margin:0 0 8px 0;
      color:var(--neon-2);
    }
    
    .about-list{
      margin:0;
      padding-left:20px;
      color:var(--muted);
      line-height:1.6;
    }
    
    .about-list li{
      margin-bottom:8px;
    }

    /* НОВАЯ СЕКЦИЯ: Навыки */
    .skills-section {
      padding: 60px 0;
    }
    
    .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 30px;
    }
    
    .skill-category {
      padding: 20px;
      border-radius: 16px;
      border: 1px solid var(--glass-brd);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      backdrop-filter: blur(12px);
    }
    
    .skill-category h3 {
      margin: 0 0 15px 0;
      color: var(--neon-1);
      font-size: 18px;
    }
    
    .skills-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .skill-tag {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--glass-brd);
    }
    
    .skill-tag.expert {
      background: rgba(0, 245, 255, 0.1);
      color: var(--neon-1);
    }
    
    .skill-tag.advanced {
      background: rgba(122, 92, 255, 0.1);
      color: var(--neon-2);
    }
    
    .skill-tag.intermediate {
      background: rgba(255, 61, 245, 0.1);
      color: var(--neon-3);
    }

    /* НОВАЯ СЕКЦИЯ: Процесс работы */
    .process-section {
      padding: 60px 0;
      background: radial-gradient(ellipse at 50% 50%, rgba(122,92,255,.05), transparent 70%);
    }
    
    .process-steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin-top: 40px;
      counter-reset: step;
    }
    
    .process-step {
      position: relative;
      padding: 30px 20px;
      border-radius: 16px;
      border: 1px solid var(--glass-brd);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      backdrop-filter: blur(12px);
      text-align: center;
    }
    
    .step-number {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #00f5ff;
      color: #0a0a12;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 14px;
      box-shadow: 0 0 10px #00f5ff, 0 0 20px rgba(0, 245, 255, 0.5);
    }
    
    .process-step h3 {
      margin: 15px 0 10px;
      color: var(--neon-1);
    }
    
    .process-step p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    /* Mobile menu overlay */
    .mobile-menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 10, 18, 0.95);
      backdrop-filter: blur(10px);
      z-index: 999;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    
    .mobile-menu-overlay.active {
      display: flex;
    }
    
    .mobile-menu-overlay .pill {
      font-size: 18px;
      padding: 15px 25px;
      min-width: 200px;
      text-align: center;
    }
    
    .close-menu {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--txt);
      font-size: 30px;
      cursor: pointer;
      padding: 10px;
    }

    /* Mobile Responsiveness - УЛУЧШЕНО */
    @media (max-width: 1024px) {
      .hero-inner {
        text-align: center;
      }
      
      .benefits-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .skills-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      /* Улучшаем навигацию для планшетов */
      nav {
        gap: 6px;
      }
      
      .pill {
        font-size: 12px;
        padding: 8px 10px;
      }
      
      .title {
        font-size: clamp(14px, 2.2vw, 20px);
        max-width: 200px;
      }
    }

    @media (max-width: 768px) {
      header {
        padding: 8px 16px;
      }
      
      .brand {
        gap: 8px;
      }
      
      .title {
        font-size: clamp(12px, 3.5vw, 16px);
        max-width: 150px;
      }
      
      /* Mobile menu styles */
      .menu-toggle {
        display: block;
      }
      
      .nav-links {
        display: none;
      }
      
      .nav-actions {
        display: flex;
        gap: 4px;
      }
      
      nav {
        gap: 4px;
      }
      
      .pill {
        padding: 8px 10px;
        font-size: 11px;
        min-height: 44px;
        display: flex;
        align-items: center;
      }
      
      .icon-pill {
        width: 36px;
        height: 36px;
        font-size: 18px;
      }
      
      .hero {
        padding: 100px 16px 20px;
      }
      
      .headline {
        font-size: 28px;
      }
      
      .cta {
        flex-direction: column;
        gap: 8px;
      }
      
      .cta .btn {
        width: 100%;
        justify-content: center;
        min-height: 44px;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .controls {
        top: 60px;
        padding: 8px 16px;
      }
      
      .search {
        flex: 1 1 100%;
      }
      
      /* Улучшаем область касания */
      .card, .btn, .pill {
        min-height: 44px;
      }
      
      /* Адаптируем панель дизайна */
      .panel .content {
        min-width: 280px;
        right: 8px;
        bottom: 8px;
      }
      
      .benefits-grid {
        grid-template-columns: 1fr;
      }
      
      .skills-grid {
        grid-template-columns: 1fr;
      }
      
      .process-steps {
        grid-template-columns: 1fr;
      }
      
      .scroll-top {
        right: 12px;
        bottom: 70px;
        width: 44px;
        height: 44px;
        font-size: 18px;
      }
      
      .fab {
        right: 12px;
        bottom: 12px;
        width: 44px;
        height: 44px;
        font-size: 20px;
      }
      
      .audio-pill {
        left: 12px;
        bottom: 12px;
        min-height: 44px;
      }
      
      .calculator-options {
        grid-template-columns: 1fr;
      }
      
      .calculator-modal .box {
        margin: 20px;
        width: calc(100% - 40px);
      }
      
      .loading-text {
        font-size: 1.5rem;
      }
      
      .loading-bar {
        width: 250px;
      }
    }

    @media (max-width: 480px) {
      .hero {
        padding: 90px 12px 16px;
      }
      
      .headline {
        font-size: 24px;
      }
      
      .sub {
        font-size: 14px;
        padding: 10px 12px;
      }
      
      .theme-grid {
        grid-template-columns: 1fr;
      }
      
      .title {
        max-width: 120px;
      }
      
      nav {
        gap: 2px;
      }
      
      .loading-text {
        font-size: 1.2rem;
      }
      
      .loading-bar {
        width: 200px;
      }
      
      /* Альтернативный вариант: постепенное сокращение текста */
      .title .full-text::after {
        content: "";
      }
    }

    @media (max-width: 400px) {
      .title .full-text {
        display: none;
      }
      
      .title .short-text {
        display: inline;
      }
      
      .nav-links {
        display: none;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .nav-actions {
        gap: 3px;
      }
      
      .pill {
        padding: 8px 10px;
        font-size: 11px;
      }
      
      .order-btn {
        padding: 8px 10px;
        font-size: 11px;
      }
    }

    @media (max-width: 360px) {
      .title .full-text {
        display: none;
      }
      
      .title .short-text {
        display: inline;
      }
      
      .brand {
        gap: 6px;
      }
      
      .badge {
        width: 36px;
        height: 36px;
        border-radius: 10px;
      }
      
      .nav-actions {
        gap: 2px;
      }
      
      .pill {
        padding: 6px 8px;
        font-size: 10px;
      }
      
      .icon-pill {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }
    }

    /* Поддержка высокой контрастности */
    @media (prefers-contrast: high) {
      :root {
        --glass-bg: rgba(255,255,255,0.15);
        --glass-brd: rgba(255,255,255,0.4);
      }
    }

    /* Поддержка reduced-motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .orb{animation:none} 
      .card:hover{transform:none} 
      .cta .btn:hover{transform:none} 
      .cursor{display:none} 
      .scroll-top{transition:none}
      .loading-screen {
        animation: none;
      }
      
      .loading-progress {
        animation: none;
      }
    }

    /* Офлайн-стили */
    .offline-notification {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 61, 245, 0.9);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      z-index: 1001;
      backdrop-filter: blur(10px);
      display: none;
    }
    
    body.offline .offline-notification {
      display: block;
    }

    /* Критически важные стили, которые должны работать даже без переменных */
    .loading-screen {
      background: #0a0a12 !important;
    }

    .loading-progress {
      background: #00f5ff !important;
    }

    /* Убедимся, что навигация всегда доступна */
    header {
      background: rgba(12,10,30,.85) !important;
    }

    .nav-actions {
      flex-shrink: 0;
      min-width: max-content;
    }

    /* Progressive text shortening */
    @media (max-width: 900px) {
      .title .full-text::after {
        content: " — Projects";
      }
    }

    @media (max-width: 768px) {
      .title .full-text::after {
        content: " Projects";
      }
    }

    @media (max-width: 640px) {
      .title .full-text {
        font-size: 14px;
      }
    }

    @media (max-width: 560px) {
      .title .full-text::after {
        content: "";
      }
    }

    /* Visually hidden class for accessibility */
    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-logo">🚀</div>
    <div class="loading-text">WOW PORTFOLIO</div>
    <div class="loading-bar">
      <div class="loading-progress" id="loadingProgress"></div>
    </div>
    <div class="loading-stats" id="loadingStats">Initializing...</div>
  </div>

  <!-- Уведомление об офлайн-режиме -->
  <div class="offline-notification" id="offlineNotification">
    🔌 Вы в офлайн-режиме. Некоторые функции могут быть недоступны.
  </div>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobileMenu">
    <button class="close-menu" id="closeMenu">×</button>
    <a class="pill nav-link" data-i18n="nav.skills" href="#skills">Навыки</a>
    <a class="pill nav-link" data-i18n="nav.projects" href="#projects">Проекты</a>
    <a class="pill nav-link" data-i18n="nav.process" href="#process">Процесс</a>
    <a class="pill nav-link" data-i18n="nav.about" href="#about">О сайте</a>
  </div>

  <canvas id="bg3d"></canvas>

  <!-- floating neon orbs for depth -->
  <div class="orb"></div>
  <div class="orb"></div>
  <div class="orb"></div>

  <header>
    <div class="brand">
      <a href="#top" class="brand-link">
        <div class="badge" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M12 2l2.6 6.4L21 9.2l-5 4.2 1.7 6.6L12 16.8 6.3 20l1.7-6.6-5-4.2 6.4-.8L12 2z" stroke="url(#g)" stroke-width="1.4"></path>
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="24" y2="24">
                <stop stop-color="#00F5FF"></stop>
                <stop offset="1" stop-color="#7A5CFF"></stop>
              </linearGradient>
            </defs>
          </svg>
        </div>
        <div class="title" id="brand">
          <span class="full-text">Komil Sultonov — Projects</span>
          <span class="short-text">KS</span>
        </div>
      </a>
    </div>
    <nav>
      <div class="nav-links">
        <a class="pill nav-link" data-i18n="nav.skills" href="#skills">Навыки</a>
        <a class="pill nav-link" data-i18n="nav.projects" href="#projects">Проекты</a>
        <a class="pill nav-link" data-i18n="nav.process" href="#process">Процесс</a>
        <a class="pill nav-link" data-i18n="nav.about" href="#about">О сайте</a>
      </div>
      <div class="nav-actions">
        <a class="pill icon-pill lang-pill" id="openLang" aria-label="Language">
          <span class="lang-code">RU</span>
        </a>
        <a class="pill order-btn" id="openCalculator" href="#">🛒 Заказать</a>
        <button class="menu-toggle" id="menuToggle">☰</button>
      </div>
    </nav>
  </header>

  <main id="main-content">
    <section class="hero" id="top">
      <div class="hero-inner">
        <h1 class="headline" id="headline" data-i18n="heroTitle">Projects Portal</h1>
        <p class="sub" id="sub">Komil Sultonov — web developer. This site is a quick entry to my projects and design approach.</p>
        <div class="cta">
          <a class="btn nav-link" data-i18n="cta.open" href="#projects">
            <span class="btn-icon">🚀</span> Open gallery
          </a>
          <a class="btn nav-link" data-i18n="cta.how" href="#about" style="--c: var(--neon-1)">
            <span class="btn-icon">ℹ️</span> More
          </a>
          <a class="btn order-btn" id="openCalculatorHero" href="#" style="--c: var(--neon-3); font-weight:900">
            <span class="btn-icon">🛒</span> Calculate cost
          </a>
        </div>
      </div>
    </section>

    <!-- Benefits Section - ДОБАВЛЕН ПЕРЕВОД -->
    <section class="wrap">
      <div class="benefits-grid">
        <div class="benefit-card">
          <span class="benefit-icon">⚡</span>
          <h3 data-i18n="benefits.speed.title">Lightning speed</h3>
          <p data-i18n="benefits.speed.desc">Optimized loading and smooth animations for better user experience</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">🎯</span>
          <h3 data-i18n="benefits.efficiency.title">Maximum efficiency</h3>
          <p data-i18n="benefits.efficiency.desc">Modern technologies to achieve your business goals and increase conversion</p>
        </div>
        <div class="benefit-card">
          <span class="benefit-icon">💎</span>
          <h3 data-i18n="benefits.design.title">Unique design</h3>
          <p data-i18n="benefits.design.desc">Exclusive style that will set you apart from competitors and be remembered by clients</p>
        </div>
      </div>
    </section>

    <!-- НОВАЯ СЕКЦИЯ: Навыки -->
    <section class="wrap skills-section" id="skills">
      <h2 class="headline" style="font-size: 2.5rem; text-align: center; margin-bottom: 20px;" data-i18n="skills.title">Технологии и навыки</h2>
      <div class="skills-grid">
        <div class="skill-category">
          <h3 data-i18n="skills.frontend">Frontend</h3>
          <div class="skills-list">
            <span class="skill-tag expert">HTML5/CSS3</span>
            <span class="skill-tag expert">JavaScript ES6+</span>
            <span class="skill-tag advanced">React</span>
            <span class="skill-tag advanced">Vue.js</span>
            <span class="skill-tag advanced">Three.js</span>
            <span class="skill-tag intermediate">TypeScript</span>
          </div>
        </div>
        <div class="skill-category">
          <h3 data-i18n="skills.backend">Backend</h3>
          <div class="skills-list">
            <span class="skill-tag advanced">Node.js</span>
            <span class="skill-tag intermediate">Express</span>
            <span class="skill-tag intermediate">MongoDB</span>
            <span class="skill-tag intermediate">REST API</span>
          </div>
        </div>
        <div class="skill-category">
          <h3 data-i18n="skills.design">Дизайн & UX</h3>
          <div class="skills-list">
            <span class="skill-tag expert">UI/UX Design</span>
            <span class="skill-tag expert">Responsive Design</span>
            <span class="skill-tag advanced">Figma</span>
            <span class="skill-tag intermediate">Adobe XD</span>
          </div>
        </div>
        <div class="skill-category">
          <h3 data-i18n="skills.tools">Инструменты</h3>
          <div class="skills-list">
            <span class="skill-tag advanced">Git & GitHub</span>
            <span class="skill-tag intermediate">Webpack</span>
            <span class="skill-tag intermediate">Docker</span>
            <span class="skill-tag intermediate">AWS</span>
          </div>
        </div>
      </div>
    </section>

    <div class="controls" id="projects">
      <div class="controls-inner">
        <div class="search">
          <input id="search" type="search" placeholder="Поиск по названию, тегам, описанию…" autocomplete="off" />
          <div class="hint" id="searchHint">⌘/Ctrl + K</div>
        </div>
      </div>
    </div>

    <section class="wrap">
      <h2 class="visually-hidden" data-i18n="projects.title">Проекты портфолио</h2>
      <div class="grid" id="grid" aria-live="polite"></div>
    </section>

    <!-- НОВАЯ СЕКЦИЯ: Процесс работы -->
    <section class="wrap process-section" id="process">
      <h2 class="headline" style="font-size: 2.5rem; text-align: center; margin-bottom: 20px;" data-i18n="process.title">Процесс работы</h2>
      <div class="process-steps">
        <div class="process-step">
          <div class="step-number">1</div>
          <h3 data-i18n="process.step1">Обсуждение</h3>
          <p data-i18n="process.step1_desc">Анализ требований, постановка целей и определение ключевых метрик успеха</p>
        </div>
        <div class="process-step">
          <div class="step-number">2</div>
          <h3 data-i18n="process.step2">Прототипирование</h3>
          <p data-i18n="process.step2_desc">Создание интерактивных прототипов и согласование концепции дизайна</p>
        </div>
        <div class="process-step">
          <div class="step-number">3</div>
          <h3 data-i18n="process.step3">Разработка</h3>
          <p data-i18n="process.step3_desc">Воплощение дизайна в код с использованием современных технологий и лучших практик</p>
        </div>
        <div class="process-step">
          <div class="step-number">4</div>
          <h3 data-i18n="process.step4">Тестирование</h3>
          <p data-i18n="process.step4_desc">Всестороннее тестирование на разных устройствах и браузерах для обеспечения качества</p>
        </div>
        <div class="process-step">
          <div class="step-number">5</div>
          <h3 data-i18n="process.step5">Запуск</h3>
          <p data-i18n="process.step5_desc">Деплой проекта, финальные настройки и обучение использованию системы</p>
        </div>
        <div class="process-step">
          <div class="step-number">6</div>
          <h3 data-i18n="process.step6">Поддержка</h3>
          <p data-i18n="process.step6_desc">Техническая поддержка и дальнейшее развитие проекта по мере необходимости</p>
        </div>
      </div>
    </section>

    <section class="wrap" id="about">
      <div class="card" role="region" aria-label="About">
        <div class="body">
          <h3 data-i18n="about.title">Обо мне и моих услугах</h3>
          <p class="desc" data-i18n="about.intro">Привет! Я Комил Султонов — веб-разработчик, специализируюсь на создании современных, высокопроизводительных сайтов с уникальным дизайном.</p>
          
          <div style="margin: 20px 0;">
            <h4 style="margin: 0 0 12px 0; color: var(--neon-1);" data-i18n="about.services.title">Что я предлагаю:</h4>
            <ul class="about-list">
              <li data-i18n="about.services.item1"><strong>Современный дизайн</strong> — стекломорфизм, неон, 3D-элементы</li>
              <li data-i18n="about.services.item2"><strong>Адаптивность</strong> — идеальное отображение на всех устройствах</li>
              <li data-i18n="about.services.item3"><strong>Высокая производительность</strong> — быстрая загрузка и плавные анимации</li>
              <li data-i18n="about.services.item4"><strong>Интерактивность</strong> — 3D-фон, анимации, интерактивные элементы</li>
              <li data-i18n="about.services.item5"><strong>SEO-оптимизация</strong> — готовность к продвижению</li>
              <li data-i18n="about.services.item6"><strong>Техническая поддержка</strong> — помощь после запуска проекта</li>
            </ul>
          </div>
          
          <div class="about-highlight">
            <h4 data-i18n="about.why.title">Почему выбирают меня?</h4>
            <p style="margin: 0; color: var(--muted); font-size: 13.5px;" data-i18n="about.why.desc">
              Каждый проект — это уникальное сочетание современных технологий и креативного подхода. 
              Я не просто создаю сайты, а разрабатываю цифровые продукты, которые выделяются 
              и приносят результат. Работаю с полной отдачей, чтобы ваш сайт стал мощным 
              инструментом для развития бизнеса.
            </p>
          </div>
          
          <div class="tags">
            <span class="tag">Web Development</span>
            <span class="tag">UI/UX Design</span>
            <span class="tag">Responsive</span>
            <span class="tag">Glass Morphism</span>
            <span class="tag">3D Graphics</span>
            <span class="tag">Performance</span>
            <span class="tag">SEO</span>
          </div>
          
          <div class="goto">
            <a class="btn order-btn" id="openCalculatorAbout" href="#" style="--c: var(--neon-3); margin-right: 10px;">
              <span class="btn-icon">💬</span> Рассчитать стоимость
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>© <span id="year"></span> · <span data-i18n="footer.created">created by</span> <a href="https://t.me/Ka_yooo_ma" target="_blank" rel="noopener">Sultonov Komil</a></footer>

  <button class="pill audio-pill" id="audioBtn" aria-pressed="false">♪ Music</button>
  <button class="scroll-top" id="scrollTop" aria-label="Наверх">↑</button>
  <button class="fab" id="themeFab" aria-label="Design">🎨</button>
  <div class="cursor" aria-hidden="true"></div>

  <!-- Background track (user file) -->
  <audio id="bgTrack" preload="auto" loop>
    <source src="Yup-ft-Craft5man.m4a" type="audio/mp4" />
  </audio>

  <!-- Language modal -->
  <div class="modal" id="langModal" role="dialog" aria-modal="true" aria-labelledby="langTitle">
    <div class="box">
      <h3 id="langTitle">Выберите язык</h3>
      <div class="row">
        <a class="pill btn" data-lang="ru">Русский</a>
        <a class="pill btn" data-lang="en">English</a>
        <a class="pill btn" data-lang="uz">Oʻzbekcha</a>
      </div>
      <div class="row" style="justify-content:flex-end"><a class="pill" id="closeLang">OK</a></div>
    </div>
  </div>

  <!-- Calculator Modal -->
  <div class="modal calculator-modal" id="calculatorModal" role="dialog" aria-modal="true" aria-labelledby="calculatorTitle">
    <div class="box">
      <h3 id="calculatorTitle">Калькулятор заказа</h3>
      
      <div class="calculator-progress">
        <div class="progress-step active">1</div>
        <div class="progress-step">2</div>
        <div class="progress-step">3</div>
        <div class="progress-step">4</div>
      </div>

      <!-- Step 1: Site Type -->
      <div class="calculator-step active" id="step1">
        <h4 data-i18n="calculator.step1.title">Тип сайта</h4>
        <div class="calculator-options">
          <div class="calculator-option" data-value="landing">
            <div>🛬</div>
            <div data-i18n="calculator.step1.option1">Одностраничный (лендинг)</div>
          </div>
          <div class="calculator-option" data-value="multi">
            <div>📑</div>
            <div data-i18n="calculator.step1.option2">Многостраничный</div>
          </div>
        </div>
        <div class="calculator-navigation">
          <button class="pill" disabled data-i18n="calculator.back">Назад</button>
          <button class="pill" id="nextStep1" data-i18n="calculator.next">Далее</button>
        </div>
      </div>

      <!-- Step 2: Design & Animation -->
      <div class="calculator-step" id="step2">
        <h4 data-i18n="calculator.step2.title">Дизайн и анимации</h4>
        <div class="calculator-options" id="designOptions">
          <div class="calculator-option" data-value="2d">
            <div>🎨</div>
            <div data-i18n="calculator.step2.option1">2D дизайн</div>
          </div>
          <div class="calculator-option" data-value="3d">
            <div>✨</div>
            <div data-i18n="calculator.step2.option2">3D элементы</div>
          </div>
          <div class="calculator-option" data-value="both">
            <div>🚀</div>
            <div data-i18n="calculator.step2.option3">2D + 3D</div>
          </div>
        </div>
        <div style="margin-top: 15px;">
          <h5 data-i18n="calculator.step2.animation">Уровень анимаций:</h5>
          <div class="calculator-options" id="animationOptions">
            <div class="calculator-option" data-value="simple">
              <div>🌀</div>
              <div data-i18n="calculator.step2.animation1">Простые</div>
            </div>
            <div class="calculator-option" data-value="advanced">
              <div>🌪️</div>
              <div data-i18n="calculator.step2.animation2">Продвинутые</div>
            </div>
          </div>
        </div>
        <div class="calculator-navigation">
          <button class="pill" id="backStep2" data-i18n="calculator.back">Назад</button>
          <button class="pill" id="nextStep2" data-i18n="calculator.next">Далее</button>
        </div>
      </div>

      <!-- Step 3: Additional Features -->
      <div class="calculator-step" id="step3">
        <h4 data-i18n="calculator.step3.title">Дополнительные опции</h4>
        <div class="calculator-options" id="featureOptions">
          <div class="calculator-option" data-value="custom">
            <div>🎭</div>
            <div data-i18n="calculator.step3.option1">Кастомный дизайн</div>
          </div>
          <div class="calculator-option" data-value="multiLang">
            <div>🌐</div>
            <div data-i18n="calculator.step3.option2">Многоязычность</div>
          </div>
          <div class="calculator-option" data-value="seo">
            <div>📈</div>
            <div data-i18n="calculator.step3.option3">SEO оптимизация</div>
          </div>
          <div class="calculator-option" data-value="support">
            <div>🛟</div>
            <div data-i18n="calculator.step3.option4">Техподдержка</div>
          </div>
        </div>
        <div style="margin-top: 15px;">
          <h5 data-i18n="calculator.step3.urgency">Срочность:</h5>
          <div class="calculator-options" id="urgencyOptions">
            <div class="calculator-option" data-value="normal">
              <div>📅</div>
              <div data-i18n="calculator.step3.urgency1">Стандартная</div>
            </div>
            <div class="calculator-option" data-value="urgent">
              <div>⚡</div>
              <div data-i18n="calculator.step3.urgency2">Срочная</div>
            </div>
          </div>
        </div>
        <div class="calculator-navigation">
          <button class="pill" id="backStep3" data-i18n="calculator.back">Назад</button>
          <button class="pill" id="nextStep3" data-i18n="calculator.next">Далее</button>
        </div>
      </div>

      <!-- Step 4: Summary & Price -->
      <div class="calculator-step" id="step4">
        <h4 data-i18n="calculator.step4.title">Итоговая стоимость</h4>
        <div class="calculator-price" id="finalPrice">$0</div>
        <div class="calculator-summary" id="orderSummary">
          <!-- Summary will be filled by JavaScript -->
        </div>
        <div class="calculator-navigation">
          <button class="pill" id="backStep4" data-i18n="calculator.back">Назад</button>
          <a class="pill order-btn" id="sendOrder" href="https://t.me/Ka_yooo_ma" target="_blank" data-i18n="calculator.order">Заказать</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Design panel (palettes + geometry + lock background) -->
  <div class="panel" id="themePanel">
    <div class="content">
      <strong>🎨 <span id="designTitle">Дизайн</span></strong>

      <div style="margin-top:10px" class="section-title" id="paletteTitle">Палитры</div>
      <div class="theme-grid" id="themeGrid"></div>

      <div style="margin-top:12px" class="section-title" id="geoTitle">Фигура</div>
      <div class="theme-grid" id="geoGrid"></div>

      <div class="row" style="justify-content:space-between">
        <label class="lock"><input type="checkbox" id="lockBg"> <span id="lockBgLabel">Не менять фон</span></label>
        <button class="pill" id="closeTheme">OK</button>
      </div>
    </div>
  </div>

  <!-- three.js -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

  <script>
    // === DEBUG SYSTEM ===
    const debug = {
      log: function(message, data = null) {
        const timestamp = new Date().toLocaleTimeString();
        const logMessage = `[${timestamp}] ${message}`;
        console.log(logMessage);
        if (data) console.log('Data:', data);
      },
      error: function(message, error = null) {
        const timestamp = new Date().toLocaleTimeString();
        console.error(`[${timestamp}] ERROR: ${message}`);
        if (error) console.error('Error details:', error);
      },
      warn: function(message, data = null) {
        const timestamp = new Date().toLocaleTimeString();
        console.warn(`[${timestamp}] WARNING: ${message}`);
        if (data) console.warn('Warning data:', data);
      }
    };

    // === LOADING SCREEN ===
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingProgress = document.getElementById('loadingProgress');
    const loadingStats = document.getElementById('loadingStats');
    
    let loadedItems = 0;
    const totalItems = 10; // fonts, three.js, images, etc.
    
    function updateProgress(item) {
      loadedItems++;
      const progress = (loadedItems / totalItems) * 100;
      loadingProgress.style.width = `${progress}%`;
      loadingStats.textContent = `${item}... (${Math.round(progress)}%)`;
      
      if (loadedItems >= totalItems) {
        setTimeout(() => {
          loadingScreen.classList.add('hidden');
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 800);
        }, 500);
      }
    }
    
    // Simulate loading progress
    setTimeout(() => updateProgress('Загрузка шрифтов'), 300);
    setTimeout(() => updateProgress('Инициализация 3D'), 600);
    setTimeout(() => updateProgress('Загрузка интерфейса'), 900);
    setTimeout(() => updateProgress('Подготовка проектов'), 1200);
    setTimeout(() => updateProgress('Настройка анимаций'), 1500);
    setTimeout(() => updateProgress('Загрузка медиа'), 1800);
    setTimeout(() => updateProgress('Оптимизация'), 2100);
    setTimeout(() => updateProgress('Финальная настройка'), 2400);
    setTimeout(() => updateProgress('Запуск'), 2700);
    setTimeout(() => updateProgress('Готово!'), 3000);

    // === MOBILE MENU FUNCTIONALITY ===
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const closeMenu = document.getElementById('closeMenu');
    
    menuToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      mobileMenu.classList.add('active');
      debug.log('Mobile menu opened');
    });
    
    closeMenu.addEventListener('click', function(e) {
      e.preventDefault();
      mobileMenu.classList.remove('active');
      debug.log('Mobile menu closed');
    });
    
    // Close mobile menu when clicking on a link
    mobileMenu.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', function() {
        mobileMenu.classList.remove('active');
        debug.log('Mobile menu closed via link click');
      });
    });
    
    // Close mobile menu when clicking outside
    mobileMenu.addEventListener('click', function(e) {
      if (e.target === mobileMenu) {
        mobileMenu.classList.remove('active');
        debug.log('Mobile menu closed via outside click');
      }
    });

    // === ОФФЛАЙН-МЕНЕДЖЕР ===
    class OfflineManager {
      constructor() {
        this.init();
      }
      
      init() {
        this.updateOnlineStatus();
        window.addEventListener('online', () => this.updateOnlineStatus());
        window.addEventListener('offline', () => this.updateOnlineStatus());
      }
      
      updateOnlineStatus() {
        const isOnline = navigator.onLine;
        document.body.classList.toggle('offline', !isOnline);
        
        if (!isOnline) {
          debug.warn('App is now offline');
          this.cacheCriticalData();
        } else {
          debug.log('App is now online');
        }
      }
      
      cacheCriticalData() {
        // Кэшируем критически важные данные
        if ('caches' in window) {
          caches.open('portfolio-critical').then(cache => {
            cache.addAll([
              '/',
              '/styles.css',
              '/script.js'
            ]);
          });
        }
      }
    }
    
    // Инициализация офлайн-менеджера
    const offlineManager = new OfflineManager();

    // === TRANSLATIONS - ДОБАВЛЕН ПЕРЕВОД ДЛЯ БЛОКА BENEFITS ===
    const i18n = {
      ru: {
        brand: 'Komil Sultonov — Проекты',
        heroTitle: 'Портал проектов',
        nav: { 
          skills: 'Навыки',
          projects: 'Проекты', 
          process: 'Процесс',
          about: 'О сайте'
        },
        heroSub: 'Komil Sultonov — веб‑разработчик. Этот сайт — быстрый вход в мои проекты и стиль работы.',
        cta: { open: '🚀 Открыть галерею', how: 'ℹ️ Подробнее', order: '🛒 Заказать', orderSite: '🛒 Рассчитать стоимость' },
        searchPh: 'Поиск по названию, тегам, описанию…',
        searchHint: '⌘/Ctrl + K',
        benefits: {
          speed: {
            title: 'Молниеносная скорость',
            desc: 'Оптимизированная загрузка и плавные анимации для лучшего пользовательского опыта'
          },
          efficiency: {
            title: 'Максимальная эффективность',
            desc: 'Современные технологии для достижения ваших бизнес-целей и увеличения конверсии'
          },
          design: {
            title: 'Уникальный дизайн',
            desc: 'Эксклюзивный стиль, который выделит вас среди конкурентов и запомнится клиентам'
          }
        },
        skills: {
          title: "Технологии и навыки",
          frontend: "Frontend",
          backend: "Backend", 
          design: "Дизайн & UX",
          tools: "Инструменты"
        },
        projects: {
          title: "Проекты портфолио"
        },
        process: {
          title: "Процесс работы",
          step1: "Обсуждение",
          step1_desc: "Анализ требований, постановка целей и определение ключевых метрик успеха",
          step2: "Прототипирование", 
          step2_desc: "Создание интерактивных прототипов и согласование концепции дизайна",
          step3: "Разработка",
          step3_desc: "Воплощение дизайна в код с использованием современных технологий и лучших практик",
          step4: "Тестирование",
          step4_desc: "Всестороннее тестирование на разных устройствах и браузерах для обеспечения качества",
          step5: "Запуск",
          step5_desc: "Деплой проекта, финальные настройки и обучение использованию системы", 
          step6: "Поддержка",
          step6_desc: "Техническая поддержка и дальнейшее развитие проекта по мере необходимости"
        },
        about: { 
          title: 'Обо мне и моих услугах',
          intro: 'Привет! Я Комил Султонов — веб-разработчик, специализируюсь на создании современных, высокопроизводительных сайтов с уникальным дизайном.',
          services: {
            title: 'Что я предлагаю:',
            item1: '<strong>Современный дизайн</strong> — стекломорфизм, неон, 3D-элементы',
            item2: '<strong>Адаптивность</strong> — идеальное отображение на всех устройствах',
            item3: '<strong>Высокая производительность</strong> — быстрая загрузка и плавные анимации',
            item4: '<strong>Интерактивность</strong> — 3D-фон, анимации, интерактивные элементы',
            item5: '<strong>SEO-оптимизация</strong> — готовность к продвижению',
            item6: '<strong>Техническая поддержка</strong> — помощь после запуска проекта'
          },
          why: {
            title: 'Почему выбирают меня?',
            desc: 'Каждый проект — это уникальное сочетание современных технологий и креативного подхода. Я не просто создаю сайты, а разрабатываю цифровые продукты, которые выделяются и приносят результат. Работаю с полной отдачей, чтобы ваш сайт стал мощным инструментом для развития бизнеса.'
          }
        },
        calculator: {
          step1: {
            title: 'Тип сайта',
            option1: 'Одностраничный (лендинг)',
            option2: 'Многостраничный'
          },
          step2: {
            title: 'Дизайн и анимации',
            option1: '2D дизайн',
            option2: '3D элементы',
            option3: '2D + 3D',
            animation: 'Уровень анимаций:',
            animation1: 'Простые',
            animation2: 'Продвинутые'
          },
          step3: {
            title: 'Дополнительные опции',
            option1: 'Кастомный дизайн',
            option2: 'Многоязычность',
            option3: 'SEO оптимизация',
            option4: 'Техподдержка',
            urgency: 'Срочность:',
            urgency1: 'Стандартная',
            urgency2: 'Срочная'
          },
          step4: {
            title: 'Итоговая стоимость'
          },
          back: 'Назад',
          next: 'Далее',
          order: 'Заказать'
        },
        ui: { 
          theme: 'Тема', 
          up: 'Наверх ↑', 
          made: 'Создано', 
          open: 'ОТКРЫТЬ →', 
          langTitle: 'Выберите язык', 
          music: 'Музыка', 
          design:'Дизайн', 
          palette:'Палитры', 
          geometry:'Фигура', 
          lockBg:'Не менять фон' 
        },
        footer: {
          created: 'created by'
        }
      },
      en: {
        brand: 'Komil Sultonov — Projects',
        heroTitle: 'Projects Portal',
        nav: { 
          skills: 'Skills',
          projects: 'Projects', 
          process: 'Process',
          about: 'About'
        },
        heroSub: 'Komil Sultonov — web developer. This site is a quick entry to my projects and design approach.',
        cta: { open: '🚀 Open gallery', how: 'ℹ️ More', order: '🛒 Order', orderSite: '🛒 Calculate cost' },
        benefits: {
          speed: {
            title: 'Lightning speed',
            desc: 'Optimized loading and smooth animations for better user experience'
          },
          efficiency: {
            title: 'Maximum efficiency',
            desc: 'Modern technologies to achieve your business goals and increase conversion'
          },
          design: {
            title: 'Unique design',
            desc: 'Exclusive style that will set you apart from competitors and be remembered by clients'
          }
        },
        skills: {
          title: "Technologies & Skills",
          frontend: "Frontend",
          backend: "Backend",
          design: "Design & UX", 
          tools: "Tools"
        },
        projects: {
          title: "Portfolio Projects"
        },
        process: {
          title: "Work Process",
          step1: "Discussion",
          step1_desc: "Requirements analysis, goal setting and defining key success metrics",
          step2: "Prototyping",
          step2_desc: "Creating interactive prototypes and approving design concept",
          step3: "Development",
          step3_desc: "Implementing design into code using modern technologies and best practices", 
          step4: "Testing",
          step4_desc: "Comprehensive testing on different devices and browsers to ensure quality",
          step5: "Launch",
          step5_desc: "Project deployment, final settings and user training",
          step6: "Support", 
          step6_desc: "Technical support and further project development as needed"
        },
        about: { 
          title: 'About Me & Services',
          intro: 'Hi! I\'m Komil Sultonov — a web developer specializing in creating modern, high-performance websites with unique design.',
          services: {
            title: 'What I offer:',
            item1: '<strong>Modern design</strong> — glassmorphism, neon, 3D elements',
            item2: '<strong>Responsiveness</strong> — perfect display on all devices',
            item3: '<strong>High performance</strong> — fast loading and smooth animations',
            item4: '<strong>Interactivity</strong> — 3D background, animations, interactive elements',
            item5: '<strong>SEO optimization</strong> — ready for promotion',
            item6: '<strong>Technical support</strong> — assistance after project launch'
          },
          why: {
            title: 'Why choose me?',
            desc: 'Every project is a unique combination of modern technologies and creative approach. I don\'t just create websites, but develop digital products that stand out and deliver results. I work with full dedication to make your website a powerful tool for business development.'
          }
        },
        calculator: {
          step1: {
            title: 'Site type',
            option1: 'One-page (landing)',
            option2: 'Multi-page'
          },
          step2: {
            title: 'Design & animations',
            option1: '2D design',
            option2: '3D elements',
            option3: '2D + 3D',
            animation: 'Animation level:',
            animation1: 'Simple',
            animation2: 'Advanced'
          },
          step3: {
            title: 'Additional options',
            option1: 'Custom design',
            option2: 'Multilingual',
            option3: 'SEO optimization',
            option4: 'Tech support',
            urgency: 'Urgency:',
            urgency1: 'Standard',
            urgency2: 'Urgent'
          },
          step4: {
            title: 'Final cost'
          },
          back: 'Back',
          next: 'Next',
          order: 'Order'
        },
        ui: { 
          theme: 'Theme', 
          up: 'Up ↑', 
          made: 'Created by', 
          open: 'OPEN →', 
          langTitle: 'Choose language', 
          music: 'Music', 
          design:'Design', 
          palette:'Palettes', 
          geometry:'Geometry', 
          lockBg:'Keep background' 
        },
        footer: {
          created: 'created by'
        }
      },
      uz: {
        brand: 'Komil Sultonov — Loyihalar',
        heroTitle: 'Loyihalar portali',
        nav: { 
          skills: 'Ko\'nikmalar',
          projects: 'Loyihalar', 
          process: 'Jarayon',
          about: 'Sayt haqida'
        },
        heroSub: 'Komil Sultonov — veb‑dasturchi. Bu sayt mening loyihalarim va uslubimga kirish uchun tez yoʻl.',
        cta: { open: '🚀 Galereyani ochish', how: 'ℹ️ Batafsil', order: '🛒 Buyurtma', orderSite: '🛒 Narxni hisoblash' },
        benefits: {
          speed: {
            title: 'Momaqaldiroq tezlik',
            desc: 'Yaxshi foydalanuvchi tajribasi uchun optimallashtirilgan yuklash va silliq animatsiyalar'
          },
          efficiency: {
            title: 'Maksimal samaradorlik',
            desc: 'Biznes maqsadlaringizga erishish va konversiyani oshirish uchun zamonaviy texnologiyalar'
          },
          design: {
            title: 'Noyob dizayn',
            desc: 'Sizni raqobatchilardan ajratib turadigan va mijozlar tomonidan esda qolarli eksklyuziv uslub'
          }
        },
        skills: {
          title: "Texnologiyalar va ko'nikmalar",
          frontend: "Frontend",
          backend: "Backend", 
          design: "Dizayn & UX",
          tools: "Asboblar"
        },
        projects: {
          title: "Portfel loyihalari"
        },
        process: {
          title: "Ish jarayoni",
          step1: "Muhokama",
          step1_desc: "Talablarni tahlil qilish, maqsadlarni belgilash va asosiy muvaffaqiyat ko'rsatkichlarini aniqlash",
          step2: "Prototiplash", 
          step2_desc: "Interaktiv prototiplarni yaratish va dizayn kontseptsiyasini kelishish",
          step3: "Ishlab chiqish",
          step3_desc: "Dizaynni zamonaviy texnologiyalar va eng yaxshi amaliyotlardan foydalangan holda kodga aylantirish",
          step4: "Testlash",
          step4_desc: "Sifatni ta'minlash uchun turli qurilmalar va brauzerlarda har tomonlama testlash",
          step5: "Ishga tushirish",
          step5_desc: "Loyihani joylashtirish, yakuniy sozlamalar va foydalanish bo'yicha o'qitish", 
          step6: "Qo'llab-quvvatlash",
          step6_desc: "Texnik yordam va loyihani zarurat bo'yicha keyingi rivojlantirish"
        },
        about: { 
          title: 'Men va xizmatlarim haqida',
          intro: 'Salom! Men Komil Sultonov — zamonaviy, yuqori samarali va noyob dizaynga ega saytlarni yaratishga ixtisoslashgan veb-dasturchiman.',
          services: {
            title: 'Men nimalarni taklif qilaman:',
            item1: '<strong>Zamonaviy dizayn</strong> — shisha morfizmi, neon, 3D elementlar',
            item2: '<strong>Moslashuvchanlik</strong> — barcha qurilmalarda mukammal ko‘rinish',
            item3: '<strong>Yuqori samaradorlik</strong> — tez yuklanish va silliq animatsiyalar',
            item4: '<strong>Interaktivlik</strong> — 3D fon, animatsiyalar, interaktiv elementlar',
            item5: '<strong>SEO optimizatsiya</strong> — targ‘ibga tayyor',
            item6: '<strong>Texnik yordam</strong> — loyiha ishga tushganidan keyin yordam'
          },
          why: {
            title: 'Nega meni tanlaysiz?',
            desc: 'Har bir loyiha zamonaviy texnologiyalar va ijodiy yondashuvning noyob uyg\'unligidir. Men shunchaki sayt yaratmayman, balki ajralib turadigan va natija beradigan raqamli mahsulotlarni ishlab chiqaman. Sizning saytingiz biznesni rivojlantirishning kuchli vositasi bo\'lishi uchun to\'liq berilgan holda ishlayman.'
          }
        },
        calculator: {
          step1: {
            title: 'Sayt turi',
            option1: 'Bir sahifali (lending)',
            option2: 'Ko‘p sahifali'
          },
          step2: {
            title: 'Dizayn va animatsiyalar',
            option1: '2D dizayn',
            option2: '3D elementlar',
            option3: '2D + 3D',
            animation: 'Animatsiya darajasi:',
            animation1: 'Oddiy',
            animation2: 'Murakkab'
          },
          step3: {
            title: 'Qo‘shimcha imkoniyatlar',
            option1: 'Maxsus dizayn',
            option2: 'Ko‘p tillilik',
            option3: 'SEO optimizatsiya',
            option4: 'Texnik yordam',
            urgency: 'Shoshilinchlik:',
            urgency1: 'Standart',
            urgency2: 'Shoshilinch'
          },
          step4: {
            title: 'Yakuniy narx'
          },
          back: 'Orqaga',
          next: 'Keyingi',
          order: 'Buyurtma'
        },
        ui: { 
          theme: 'Mavzu', 
          up: 'Yuqoriga ↑', 
          made: 'Muallif', 
          open: 'OCHISH →', 
          langTitle: 'Tilni tanlang', 
          music: 'Musiqa', 
          design:'Dizayn', 
          palette:'Palitralar', 
          geometry:'Geometriya', 
          lockBg:'Fon o‘zgarmasin' 
        },
        footer: {
          created: 'muallif'
        }
      }
    };

    let lang = localStorage.getItem('lang') || 'ru';

    function applyLang(l){
      lang = l; 
      localStorage.setItem('lang', l); 
      document.documentElement.lang = l;
      const t = i18n[lang];
      
      // Обновляем код языка в кнопке
      const langCode = l === 'ru' ? 'RU' : l === 'en' ? 'EN' : 'UZ';
      document.querySelector('.lang-code').textContent = langCode;
      
      // Apply translations to brand name
      const fullText = document.querySelector('.title .full-text');
      const shortText = document.querySelector('.title .short-text');
      if (fullText) fullText.textContent = t.brand;
      if (shortText) shortText.textContent = 'KS'; // Инициалы остаются всегда KS
      
      // Apply translations to all elements
      document.querySelectorAll('[data-i18n="nav.skills"]').forEach(el => el.textContent = t.nav.skills);
      document.querySelectorAll('[data-i18n="nav.projects"]').forEach(el => el.textContent = t.nav.projects);
      document.querySelectorAll('[data-i18n="nav.process"]').forEach(el => el.textContent = t.nav.process);
      document.querySelectorAll('[data-i18n="nav.about"]').forEach(el => el.textContent = t.nav.about);
      document.getElementById('headline').innerHTML = t.heroTitle;
      document.getElementById('sub').textContent = t.heroSub;
      document.querySelector('[data-i18n="cta.open"]').textContent = t.cta.open;
      document.querySelector('[data-i18n="cta.how"]').textContent = t.cta.how;
      
      // Translate benefits
      document.querySelector('[data-i18n="benefits.speed.title"]').textContent = t.benefits.speed.title;
      document.querySelector('[data-i18n="benefits.speed.desc"]').textContent = t.benefits.speed.desc;
      document.querySelector('[data-i18n="benefits.efficiency.title"]').textContent = t.benefits.efficiency.title;
      document.querySelector('[data-i18n="benefits.efficiency.desc"]').textContent = t.benefits.efficiency.desc;
      document.querySelector('[data-i18n="benefits.design.title"]').textContent = t.benefits.design.title;
      document.querySelector('[data-i18n="benefits.design.desc"]').textContent = t.benefits.design.desc;
      
      // Translate skills section
      document.querySelector('[data-i18n="skills.title"]').textContent = t.skills.title;
      document.querySelectorAll('[data-i18n="skills.frontend"]').forEach(el => el.textContent = t.skills.frontend);
      document.querySelectorAll('[data-i18n="skills.backend"]').forEach(el => el.textContent = t.skills.backend);
      document.querySelectorAll('[data-i18n="skills.design"]').forEach(el => el.textContent = t.skills.design);
      document.querySelectorAll('[data-i18n="skills.tools"]').forEach(el => el.textContent = t.skills.tools);
      
      // Translate projects title
      document.querySelector('[data-i18n="projects.title"]').textContent = t.projects.title;
      
      // Translate process section
      document.querySelector('[data-i18n="process.title"]').textContent = t.process.title;
      document.querySelectorAll('[data-i18n="process.step1"]').forEach(el => el.textContent = t.process.step1);
      document.querySelectorAll('[data-i18n="process.step1_desc"]').forEach(el => el.textContent = t.process.step1_desc);
      document.querySelectorAll('[data-i18n="process.step2"]').forEach(el => el.textContent = t.process.step2);
      document.querySelectorAll('[data-i18n="process.step2_desc"]').forEach(el => el.textContent = t.process.step2_desc);
      document.querySelectorAll('[data-i18n="process.step3"]').forEach(el => el.textContent = t.process.step3);
      document.querySelectorAll('[data-i18n="process.step3_desc"]').forEach(el => el.textContent = t.process.step3_desc);
      document.querySelectorAll('[data-i18n="process.step4"]').forEach(el => el.textContent = t.process.step4);
      document.querySelectorAll('[data-i18n="process.step4_desc"]').forEach(el => el.textContent = t.process.step4_desc);
      document.querySelectorAll('[data-i18n="process.step5"]').forEach(el => el.textContent = t.process.step5);
      document.querySelectorAll('[data-i18n="process.step5_desc"]').forEach(el => el.textContent = t.process.step5_desc);
      document.querySelectorAll('[data-i18n="process.step6"]').forEach(el => el.textContent = t.process.step6);
      document.querySelectorAll('[data-i18n="process.step6_desc"]').forEach(el => el.textContent = t.process.step6_desc);
      
      // Translate order buttons
      document.querySelectorAll('#openCalculator').forEach(btn => {
        btn.textContent = t.cta.order;
      });
      document.querySelectorAll('#openCalculatorHero, #openCalculatorAbout').forEach(btn => {
        btn.textContent = t.cta.orderSite;
      });
      
      const s = document.getElementById('search'); 
      s.placeholder = t.searchPh;
      document.getElementById('searchHint').textContent = t.searchHint;
      
      // About section translations
      document.querySelector('[data-i18n="about.title"]').textContent = t.about.title;
      document.querySelector('[data-i18n="about.intro"]').textContent = t.about.intro;
      document.querySelector('[data-i18n="about.services.title"]').textContent = t.about.services.title;
      document.querySelectorAll('[data-i18n^="about.services.item"]').forEach((el, i) => {
        el.innerHTML = t.about.services[`item${i+1}`];
      });
      document.querySelector('[data-i18n="about.why.title"]').textContent = t.about.why.title;
      document.querySelector('[data-i18n="about.why.desc"]').textContent = t.about.why.desc;
      
      // Calculator translations
      document.getElementById('calculatorTitle').textContent = t.calculator.step1.title;
      document.querySelectorAll('[data-i18n^="calculator."]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const parts = key.split('.');
        let value = t;
        for (const part of parts) {
          if (value[part]) {
            value = value[part];
          } else {
            value = null;
            break;
          }
        }
        if (value && typeof value === 'string') {
          el.textContent = value;
        }
      });
      
      document.getElementById('langTitle').textContent = t.ui.langTitle;
      document.getElementById('audioBtn').textContent = '♪ ' + t.ui.music;
      
      // Design panel captions
      document.getElementById('designTitle').textContent = t.ui.design;
      document.getElementById('paletteTitle').textContent = t.ui.palette;
      document.getElementById('geoTitle').textContent = t.ui.geometry;
      document.getElementById('lockBgLabel').textContent = t.ui.lockBg;
      
      // Footer
      document.querySelector('[data-i18n="footer.created"]').textContent = t.footer.created;
      
      render();
      document.querySelectorAll('.goto a.primary').forEach(a=> a.textContent = t.ui.open);
    }

    // === PROJECTS DATA ===
    const projects = [
      { 
        title: 'Superlink', 
        url: 'https://kayoooma.github.io/superlink', 
        preview: '', 
        desc: {
          ru:'Компактный хаб ссылок и быстрых переходов.', 
          en:'Compact hub of links and quick jumps.', 
          uz:'Havolalar va tez o‘tishlar uchun ixcham xab.'
        }, 
        tags: ['links','tool','ui'], 
        color: '#00f5ff' 
      },
      { 
        title: 'Resume through VideoGame', 
        url: 'https://kayoooma.github.io/resume-through-videogame/', 
        preview: '', 
        desc: {
          ru:'Резюме в формате мини‑видеоигры.', 
          en:'Resume as a mini‑video game.', 
          uz:'Mini‑o‘yin formatidagi rezyume.'
        }, 
        tags: ['resume','game','creative'], 
        color: '#ff3df5' 
      },
      { 
        title: 'Uzum — Hire Me', 
        url: 'https://kayoooma.github.io/uzum_hire_me/', 
        preview: '', 
        desc: {
          ru:'Креативная заявка для компании Uzum.', 
          en:'Creative application for Uzum.', 
          uz:'Uzum kompaniyasi uchun ijodiy ariza.'
        }, 
        tags: ['promo','job','case'], 
        color: '#7a5cff' 
      },
      { 
        title: 'Project Manager', 
        url: 'https://kayoooma.github.io/project_manager', 
        preview: '', 
        desc: {
          ru:'Лендинг проектного менеджера.', 
          en:'Project Manager landing page.', 
          uz:'Loyiha menejeri uchun landing.'
        }, 
        tags: ['pm','portfolio'], 
        color: '#00f5ff' 
      },
      { 
        title: 'Project Boboy', 
        url: 'https://kayoooma.github.io/project_boboy_site/', 
        preview: '', 
        desc: {
          ru:'Концепт и демонстрационный сайт.', 
          en:'Concept and demo site.', 
          uz:'Konsеpt va demo sayt.'
        }, 
        tags: ['concept','landing'], 
        color: '#7a5cff' 
      },
      { 
        title: 'Project Manager — Vladislav', 
        url: 'https://kayoooma.github.io/project_manager_Vladislav/', 
        preview: '', 
        desc: {
          ru:'Вариант портфолио ПМ от Владислава.', 
          en:'PM portfolio variant by Vladislav.', 
          uz:'Vladislavdan PM portfeli varianti.'
        }, 
        tags: ['pm','portfolio'], 
        color: '#ff3df5' 
      },
    ];

    function shot(url){
      const encoded = encodeURIComponent(url);
      return `https://s.wordpress.com/mshots/v1/${encoded}?w=400&h=300`;
    }

    // === RENDER CARDS ===
    const grid = document.getElementById('grid');
    const search = document.getElementById('search');
    const state = { q: '' };

    function cardTemplate(p){
      const c = p.color || '#7a5cff';
      const t = i18n[lang];
      const img = p.preview && p.preview.trim() ? p.preview : shot(p.url);
      const description = (p.desc && p.desc[lang]) || p.desc.ru || p.desc.en || '';
      
      return `
        <article class="card" data-tags="${p.tags.join(',')}" tabindex="0" role="article" aria-label="${p.title}">
          <div class="thumb"><img src="${img}" alt="${p.title} preview" referrerpolicy="no-referrer" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMWExYjMyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPiR7cC50aXRsZX08L3RleHQ+PC9zdmc+'"/></div>
          <div class="body">
            <h3>${p.title}</h3>
            <p class="desc">${description}</p>
            <div class="tags">${p.tags.map(tag=>`<span class="tag">${tag}</span>`).join('')}</div>
            <div class="goto">
              <a class="primary" href="${p.url}" target="_blank" rel="noopener" aria-label="Open ${p.title}" style="--c:${c}">${t.ui.open}</a>
            </div>
          </div>
        </article>`
    }

    function render(){
      const q = state.q.toLowerCase();
      const filtered = projects.filter(p=>{
        const matchesQ = !q || [p.title, (p.desc && (p.desc[lang]||p.desc.ru||p.desc.en||'')), p.tags.join(' ')].join(' ').toLowerCase().includes(q);
        return matchesQ;
      });
      grid.innerHTML = filtered.map(cardTemplate).join('');
    }

    render();

    search.addEventListener('input', (e)=>{ state.q = e.target.value; render(); });

    // Quick focus Ctrl/⌘+K
    window.addEventListener('keydown', (e)=>{ if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); search.focus(); }});

    // === CALCULATOR FUNCTIONALITY ===
    const calculatorModal = document.getElementById('calculatorModal');
    const calculatorSteps = document.querySelectorAll('.calculator-step');
    const progressSteps = document.querySelectorAll('.progress-step');
    let currentStep = 0;
    let orderData = {
      siteType: '',
      design: '',
      animation: '',
      customDesign: false,
      multiLang: false,
      seo: false,
      support: false,
      urgency: ''
    };

    // Open calculator from any order button
    document.querySelectorAll('#openCalculator, #openCalculatorHero, #openCalculatorAbout').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        calculatorModal.classList.add('open');
        resetCalculator();
        debug.log('Calculator opened');
      });
    });

    // Close calculator
    calculatorModal.addEventListener('click', (e) => {
      if (e.target === calculatorModal) {
        calculatorModal.classList.remove('open');
        debug.log('Calculator closed');
      }
    });

    function resetCalculator() {
      currentStep = 0;
      orderData = {
        siteType: '',
        design: '',
        animation: '',
        customDesign: false,
        multiLang: false,
        seo: false,
        support: false,
        urgency: ''
      };
      updateCalculatorSteps();
      document.querySelectorAll('.calculator-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      updatePrice();
    }

    function updateCalculatorSteps() {
      calculatorSteps.forEach((step, index) => {
        step.classList.toggle('active', index === currentStep);
      });
      progressSteps.forEach((step, index) => {
        step.classList.toggle('active', index <= currentStep);
      });
    }

    function updatePrice() {
      let price = 0;
      
      // Base price based on site type
      if (orderData.siteType === 'landing') price += 300;
      else if (orderData.siteType === 'multi') price += 600;
      
      // Design complexity
      if (orderData.design === '2d') price += 100;
      else if (orderData.design === '3d') price += 300;
      else if (orderData.design === 'both') price += 400;
      
      // Animation level
      if (orderData.animation === 'simple') price += 50;
      else if (orderData.animation === 'advanced') price += 150;
      
      // Additional features
      if (orderData.customDesign) price += 200;
      if (orderData.multiLang) price += 100;
      if (orderData.seo) price += 150;
      if (orderData.support) price += 100;
      
      // Urgency
      if (orderData.urgency === 'urgent') price += 200;
      
      document.getElementById('finalPrice').textContent = '$' + price;
      updateOrderSummary();
    }

    function updateOrderSummary() {
      const summary = document.getElementById('orderSummary');
      const t = i18n[lang];
      
      let html = '';
      if (orderData.siteType) {
        html += `<div class="calculator-summary-item">
          <span>${t.calculator.step1.title}:</span>
          <span>${orderData.siteType === 'landing' ? t.calculator.step1.option1 : t.calculator.step1.option2}</span>
        </div>`;
      }
      
      if (orderData.design) {
        html += `<div class="calculator-summary-item">
          <span>${t.calculator.step2.title}:</span>
          <span>${orderData.design === '2d' ? t.calculator.step2.option1 : 
                 orderData.design === '3d' ? t.calculator.step2.option2 : 
                 t.calculator.step2.option3}</span>
        </div>`;
      }
      
      if (orderData.animation) {
        html += `<div class="calculator-summary-item">
          <span>${t.calculator.step2.animation}:</span>
          <span>${orderData.animation === 'simple' ? t.calculator.step2.animation1 : t.calculator.step2.animation2}</span>
        </div>`;
      }
      
      // Additional options
      const additionalOptions = [];
      if (orderData.customDesign) additionalOptions.push(t.calculator.step3.option1);
      if (orderData.multiLang) additionalOptions.push(t.calculator.step3.option2);
      if (orderData.seo) additionalOptions.push(t.calculator.step3.option3);
      if (orderData.support) additionalOptions.push(t.calculator.step3.option4);
      
      if (additionalOptions.length > 0) {
        html += `<div class="calculator-summary-item">
          <span>${t.calculator.step3.title}:</span>
          <span>${additionalOptions.join(', ')}</span>
        </div>`;
      }
      
      if (orderData.urgency) {
        html += `<div class="calculator-summary-item">
          <span>${t.calculator.step3.urgency}:</span>
          <span>${orderData.urgency === 'normal' ? t.calculator.step3.urgency1 : t.calculator.step3.urgency2}</span>
        </div>`;
      }
      
      html += `<div class="calculator-summary-item">
        <span>${t.calculator.step4.title}:</span>
        <span>${document.getElementById('finalPrice').textContent}</span>
      </div>`;
      
      summary.innerHTML = html;
    }

    // Calculator navigation
    document.getElementById('nextStep1').addEventListener('click', () => {
      if (orderData.siteType) {
        currentStep = 1;
        updateCalculatorSteps();
        debug.log('Calculator step 1 completed', { siteType: orderData.siteType });
      }
    });

    document.getElementById('nextStep2').addEventListener('click', () => {
      if (orderData.design && orderData.animation) {
        currentStep = 2;
        updateCalculatorSteps();
        debug.log('Calculator step 2 completed', { design: orderData.design, animation: orderData.animation });
      }
    });

    document.getElementById('nextStep3').addEventListener('click', () => {
      if (orderData.urgency) {
        currentStep = 3;
        updateCalculatorSteps();
        debug.log('Calculator step 3 completed', { 
          customDesign: orderData.customDesign,
          multiLang: orderData.multiLang,
          seo: orderData.seo,
          support: orderData.support,
          urgency: orderData.urgency
        });
      }
    });

    document.getElementById('backStep2').addEventListener('click', () => {
      currentStep = 0;
      updateCalculatorSteps();
      debug.log('Calculator back to step 1');
    });

    document.getElementById('backStep3').addEventListener('click', () => {
      currentStep = 1;
      updateCalculatorSteps();
      debug.log('Calculator back to step 2');
    });

    document.getElementById('backStep4').addEventListener('click', () => {
      currentStep = 2;
      updateCalculatorSteps();
      debug.log('Calculator back to step 3');
    });

    // Option selection
    document.querySelectorAll('.calculator-option').forEach(option => {
      option.addEventListener('click', (e) => {
        e.stopPropagation();
        const parent = option.closest('.calculator-options');
        const step = option.closest('.calculator-step');
        const value = option.getAttribute('data-value');
        
        // For single-select options (site type, design, animation, urgency)
        if (step.id === 'step1' || 
            (step.id === 'step2' && parent.id === 'designOptions') ||
            (step.id === 'step2' && parent.id === 'animationOptions') ||
            (step.id === 'step3' && parent.id === 'urgencyOptions')) {
          
          const siblings = parent.querySelectorAll('.calculator-option');
          siblings.forEach(sib => sib.classList.remove('selected'));
          option.classList.add('selected');
          
          if (step.id === 'step1') {
            orderData.siteType = value;
          } else if (step.id === 'step2' && parent.id === 'designOptions') {
            orderData.design = value;
          } else if (step.id === 'step2' && parent.id === 'animationOptions') {
            orderData.animation = value;
          } else if (step.id === 'step3' && parent.id === 'urgencyOptions') {
            orderData.urgency = value;
          }
        } 
        // For multi-select options (additional features)
        else if (step.id === 'step3' && parent.id === 'featureOptions') {
          option.classList.toggle('selected');
          
          // Toggle boolean features
          if (value === 'custom') orderData.customDesign = !orderData.customDesign;
          if (value === 'multiLang') orderData.multiLang = !orderData.multiLang;
          if (value === 'seo') orderData.seo = !orderData.seo;
          if (value === 'support') orderData.support = !orderData.support;
        }
        
        updatePrice();
        debug.log('Calculator option selected', { value: value, step: step.id, orderData: orderData });
      });
    });

    // Send order with pre-filled message
    document.getElementById('sendOrder').addEventListener('click', (e) => {
      const t = i18n[lang];
      let message = `Здравствуйте! Хочу заказать сайт:\n\n`;
      
      if (orderData.siteType) {
        message += `Тип: ${orderData.siteType === 'landing' ? 'Одностраничный' : 'Многостраничный'}\n`;
      }
      if (orderData.design) {
        message += `Дизайн: ${orderData.design === '2d' ? '2D' : orderData.design === '3d' ? '3D' : '2D+3D'}\n`;
      }
      if (orderData.animation) {
        message += `Анимации: ${orderData.animation === 'simple' ? 'Простые' : 'Продвинутые'}\n`;
      }
      if (orderData.urgency) {
        message += `Срочность: ${orderData.urgency === 'normal' ? 'Стандартная' : 'Срочная'}\n`;
      }
      message += `\nБюджет: ${document.getElementById('finalPrice').textContent}`;
      
      const encodedMessage = encodeURIComponent(message);
      e.target.href = `https://t.me/Ka_yooo_ma?text=${encodedMessage}`;
      debug.log('Order sent via Telegram', { message: message });
    });

    // Neon cursor glow
    const cursor = document.querySelector('.cursor');
    let cx = window.innerWidth/2, cy = window.innerHeight/2, tx = cx, ty = cy;
    function loop(){ cx += (tx - cx)*0.12; cy += (ty - cy)*0.12; cursor.style.transform = `translate(${cx}px, ${cy}px)`; requestAnimationFrame(loop) }
    loop();
    window.addEventListener('pointermove', (e)=>{ tx = e.clientX; ty = e.clientY });

    // Reactive glow inside cards
    grid.addEventListener('pointermove', (e)=>{
      const card = e.target.closest('.card'); if(!card) return;
      const r = card.getBoundingClientRect();
      const mx = ((e.clientX - r.left) / r.width) * 100;
      const my = ((e.clientY - r.top) / r.height) * 100;
      card.style.setProperty('--mx', mx + '%');
      card.style.setProperty('--my', my + '%');
    });

    // Card click opens link — with fallback if popup blocked
    grid.addEventListener('click', (e)=>{
      const link = e.target.closest('a');
      if(link) return; // native anchor works
      const card = e.target.closest('.card'); if(!card) return;
      const title = card.querySelector('h3').textContent;
      const p = projects.find(x=>x.title===title);
      if(p){ 
        const win = window.open(p.url, '_blank'); 
        if(!win){ 
          location.href = p.url; 
          debug.log('Project opened in same tab (popup blocked)', { project: p.title });
        } else {
          debug.log('Project opened in new tab', { project: p.title });
        }
      }
    });

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // === COMPLETELY REWRITTEN NAVIGATION SYSTEM ===
    class NavigationSystem {
      constructor() {
        this.currentSection = '#skills';
        this.isScrolling = false;
        this.scrollTimeout = null;
        this.headerHeight = 0;
        this.sections = {};
        this.init();
      }

      init() {
        debug.log('Navigation system initialized');
        
        // Calculate header height once
        this.headerHeight = document.querySelector('header').offsetHeight;
        debug.log('Header height calculated', { height: this.headerHeight });

        // Initialize sections data
        this.initSections();
        
        // Set up navigation click handlers
        this.setupNavClicks();
        
        // Set up intersection observer for active section detection
        this.setupIntersectionObserver();
        
        // Set initial active state
        this.setActiveNav('#skills');
        
        // Set up scroll event for scroll-to-top button
        this.setupScrollEvents();
      }

      initSections() {
        const sectionIds = ['skills', 'projects', 'process', 'about'];
        
        sectionIds.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            this.sections['#' + id] = {
              element: element,
              top: this.getSectionTop('#' + id),
              bottom: this.getSectionBottom('#' + id)
            };
            debug.log(`Section ${id} initialized`, { 
              top: this.sections['#' + id].top, 
              bottom: this.sections['#' + id].bottom 
            });
          }
        });
      }

      getSectionTop(sectionId) {
        const element = document.querySelector(sectionId);
        if (!element) return 0;
        
        const rect = element.getBoundingClientRect();
        return rect.top + window.pageYOffset - this.headerHeight - 20;
      }

      getSectionBottom(sectionId) {
        const element = document.querySelector(sectionId);
        if (!element) return 0;
        
        const rect = element.getBoundingClientRect();
        return rect.bottom + window.pageYOffset - this.headerHeight;
      }

      setupNavClicks() {
        document.querySelectorAll('a.nav-link[href^="#"]').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href');
            debug.log('Navigation link clicked', { targetId: targetId });
            
            this.smoothScrollTo(targetId);
            this.setActiveNav(targetId);
          });
        });

        // Also handle mobile menu links
        document.querySelectorAll('.mobile-menu-overlay a.nav-link[href^="#"]').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href');
            debug.log('Mobile navigation link clicked', { targetId: targetId });
            
            this.smoothScrollTo(targetId);
            this.setActiveNav(targetId);
            
            // Close mobile menu
            document.getElementById('mobileMenu').classList.remove('active');
          });
        });
      }

      smoothScrollTo(targetId) {
        if (this.isScrolling) {
          debug.log('Scroll already in progress, ignoring request', { targetId: targetId });
          return;
        }

        const targetElement = document.querySelector(targetId);
        if (!targetElement) {
          debug.error('Target element not found', { targetId: targetId });
          return;
        }

        this.isScrolling = true;
        
        // Calculate target position
        const targetPosition = this.getSectionTop(targetId);
        
        debug.log('Starting smooth scroll', { 
          targetId: targetId, 
          targetPosition: targetPosition,
          currentScroll: window.pageYOffset
        });

        // Use native smooth scroll
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });

        // Reset scrolling flag after animation completes
        setTimeout(() => {
          this.isScrolling = false;
          debug.log('Smooth scroll completed', { targetId: targetId });
        }, 1000);
      }

      setActiveNav(activeId) {
        debug.log('Setting active navigation', { activeId: activeId });
        
        // Update all navigation links
        document.querySelectorAll('a.nav-link').forEach(link => {
          const isActive = link.getAttribute('href') === activeId;
          link.classList.toggle('active', isActive);
        });

        this.currentSection = activeId;
      }

      setupIntersectionObserver() {
        const options = {
          root: null,
          rootMargin: `-${this.headerHeight + 50}px 0px -${window.innerHeight - this.headerHeight - 100}px 0px`,
          threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
          if (this.isScrolling) {
            debug.log('Ignoring intersection changes during scroll');
            return;
          }

          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const activeId = '#' + entry.target.id;
              if (activeId !== this.currentSection) {
                this.setActiveNav(activeId);
                debug.log('Active section changed via scroll', { 
                  newSection: activeId, 
                  previousSection: this.currentSection 
                });
              }
            }
          });
        }, options);

        // Observe all sections
        Object.keys(this.sections).forEach(sectionId => {
          const element = this.sections[sectionId].element;
          if (element) {
            observer.observe(element);
            debug.log('Started observing section', { sectionId: sectionId });
          }
        });
      }

      setupScrollEvents() {
        const scrollTopBtn = document.getElementById('scrollTop');
        
        const toggleScrollTop = () => {
          if (window.scrollY > 300) {
            scrollTopBtn.classList.add('visible');
          } else {
            scrollTopBtn.classList.remove('visible');
          }
        };

        window.addEventListener('scroll', toggleScrollTop);
        scrollTopBtn.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
          this.setActiveNav('#skills');
        });

        // Initialize on load
        toggleScrollTop();
      }
    }

    // Initialize navigation system
    const navigation = new NavigationSystem();

    // === Language modal ===
    const langModal = document.getElementById('langModal');
    document.getElementById('openLang').addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('langModal').classList.add('open');
        debug.log('Language modal opened');
    });

    document.getElementById('closeLang').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('langModal').classList.remove('open');
        debug.log('Language modal closed');
    });

    document.getElementById('langModal').addEventListener('click', function(e) {
        if(e.target === this) {
            this.classList.remove('open');
            debug.log('Language modal closed via overlay click');
        }
    });

    // Close modal after language selection
    langModal.querySelectorAll('[data-lang]').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const selectedLang = this.dataset.lang;
            applyLang(selectedLang); 
            document.getElementById('langModal').classList.remove('open');
            debug.log('Language changed', { language: selectedLang });
        });
    });

    // Initialize language UI
    applyLang(lang);

    // === THREE.JS BACKGROUND ===
    const canvas = document.getElementById('bg3d');
    const renderer = new THREE.WebGLRenderer({
      canvas: canvas, 
      antialias: true, 
      alpha: true
    });
    
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(55, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.z = 8;

    function resize(){ 
      const w = window.innerWidth, h = window.innerHeight; 
      renderer.setSize(w, h); 
      camera.aspect = w/h; 
      camera.updateProjectionMatrix(); 
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); 
    }
    
    resize(); 
    window.addEventListener('resize', resize);

    // Neon particle field
    const starGeo = new THREE.BufferGeometry();
    const COUNT = 900; 
    const pos = new Float32Array(COUNT * 3);
    
    for(let i = 0; i < COUNT; i++){ 
      pos[i * 3 + 0] = (Math.random() - 0.5) * 30; 
      pos[i * 3 + 1] = (Math.random() - 0.5) * 18; 
      pos[i * 3 + 2] = (Math.random() - 0.5) * 20; 
    }
    
    starGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
    
    const starMat = new THREE.PointsMaterial({ 
      size: 0.035, 
      transparent: true, 
      depthWrite: false, 
      blending: THREE.AdditiveBlending,
      color: new THREE.Color(0x00f5ff)
    });
    
    const stars = new THREE.Points(starGeo, starMat); 
    scene.add(stars);

    // Wireframe object (switchable)
    let mesh = null; 
    const lineMat = new THREE.LineBasicMaterial({ 
      transparent: true, 
      opacity: 0.55,
      color: new THREE.Color(0x7a5cff)
    });

    function setGeometry(type){ 
      if(mesh){ 
        scene.remove(mesh); 
      }
      
      let geo;
      switch(type){ 
        case 'torus': 
          geo = new THREE.TorusGeometry(2.2, 0.6, 16, 100); 
          break; 
        case 'knot': 
          geo = new THREE.TorusKnotGeometry(1.8, 0.5, 100, 16); 
          break; 
        case 'octa': 
          geo = new THREE.OctahedronGeometry(2.4, 1); 
          break; 
        case 'sphere': 
          geo = new THREE.SphereGeometry(2.4, 24, 18); 
          break; 
        default: 
          geo = new THREE.IcosahedronGeometry(2.6, 1); 
      }
      
      const wire = new THREE.WireframeGeometry(geo); 
      mesh = new THREE.LineSegments(wire, lineMat); 
      scene.add(mesh);
      
      // Force re-render
      renderer.render(scene, camera);
    }

    // Set initial geometry
    setGeometry('icosa');

    // Utility: luminance for visibility
    function hexToRgb(hex){ 
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : {r: 255, g: 255, b: 255};
    }
    
    function luminance(hex){ 
      const {r, g, b} = hexToRgb(hex); 
      const sr = [r, g, b].map(v => {
        v /= 255; 
        return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
      }); 
      return 0.2126 * sr[0] + 0.7152 * sr[1] + 0.0722 * sr[2]; 
    }

    function applyThemeTo3D(){
      const s = getComputedStyle(document.documentElement);
      const n1 = s.getPropertyValue('--neon-1').trim();
      const n2 = s.getPropertyValue('--neon-2').trim();
      const n3 = s.getPropertyValue('--neon-3').trim();
      
      // particles — primary neon
      starMat.color = new THREE.Color(n1);
      
      // choose the most visible for wireframe
      const candidates = [n3, n2, n1].sort((a, b) => luminance(b) - luminance(a));
      const chosen = candidates[0];
      lineMat.color = new THREE.Color(chosen);
      const L = luminance(chosen);
      lineMat.opacity = L < 0.4 ? 0.9 : 0.6;
    }

    // Apply initial theme
    applyThemeTo3D();

    // Parallax from pointer
    let pmx = 0, pmy = 0, ptx = 0, pty = 0;
    window.addEventListener('pointermove', (e)=>{ 
      pmx = (e.clientX / window.innerWidth - 0.5) * 2; 
      pmy = (e.clientY / window.innerHeight - 0.5) * 2; 
    });

    function animate(){ 
      ptx += (pmx - ptx) * 0.04; 
      pty += (pmy - pty) * 0.04; 
      stars.rotation.y += 0.0008; 
      stars.rotation.x += 0.0003; 
      
      if(mesh){ 
        mesh.rotation.y += 0.0015; 
        mesh.rotation.x += 0.0006; 
      } 
      
      camera.position.x = ptx * 0.8; 
      camera.position.y = -pty * 0.4; 
      camera.lookAt(0, 0, 0); 
      renderer.render(scene, camera); 
      requestAnimationFrame(animate); 
    }
    
    // Start animation
    animate();

    // Re-apply 3D colors when theme changes
    const mo = new MutationObserver(applyThemeTo3D); 
    mo.observe(document.documentElement, { 
      attributes: true, 
      attributeFilter: ['style'] 
    });

    // === PALETTES & GEOMETRIES ===
    const palettes = [
      { id:'silver-violet', name:'Silver × Violet',   neon:['#C9CCD3','#7A5CFF','#FF3DF5'], bg:['#0d0a1f','#0a0a12'] },
      { id:'black-white',  name:'Black × White',     neon:['#FFFFFF','#111111','#7A5CFF'], bg:['#0b0b0f','#07070a'] },
      { id:'yellow-violet',name:'Yellow × Violet',   neon:['#FFD644','#7A5CFF','#111111'], bg:['#0c0a14','#090813'] },
      { id:'black-gold',   name:'Black × Gold',      neon:['#F0C674','#0b0b0f','#FF3DF5'], bg:['#0b0b0f','#07070a'] },
      { id:'black-silver', name:'Black × Silver',    neon:['#D9DEE8','#0b0b0f','#7A5CFF'], bg:['#0b0b0f','#07070a'] }
    ];

    const geos = [
      { id:'icosa', name:'Icosa' },
      { id:'octa',  name:'Octa' },
      { id:'knot',  name:'Knot' },
      { id:'torus', name:'Torus' },
      { id:'sphere',name:'Sphere' }
    ];

    const themeGrid = document.getElementById('themeGrid');
    const geoGrid = document.getElementById('geoGrid');
    const lockBg = document.getElementById('lockBg');

    function renderPalettes(){
      themeGrid.innerHTML = palettes.map(p => {
        const [n1, n2, n3] = p.neon; 
        return `<div class="theme" data-palette="${p.id}">
          <span class="sw" style="background:${n1}"></span>
          <span class="sw" style="background:${n2}"></span>
          <span class="sw" style="background:${n3}"></span>
          <span style="font-size:13px">${p.name}</span>
        </div>`;
      }).join('');
    }
    
    function renderGeos(){
      geoGrid.innerHTML = geos.map(g => 
        `<div class="theme" data-geo="${g.id}">
          <span class="sw" style="background:rgba(255,255,255,.85)"></span>
          <span style="font-size:13px">${g.name}</span>
        </div>`
      ).join('');
    }
    
    renderPalettes();
    renderGeos();

    function applyPalette(paletteId){
      const p = palettes.find(x => x.id === paletteId) || palettes[0];
      const [n1, n2, n3] = p.neon;
      document.documentElement.style.setProperty('--neon-1', n1);
      document.documentElement.style.setProperty('--neon-2', n2);
      document.documentElement.style.setProperty('--neon-3', n3);
      if(!lockBg.checked){
        const [b2, b1] = p.bg;
        document.documentElement.style.setProperty('--bg-1', b1);
        document.documentElement.style.setProperty('--bg-2', b2);
      }
      localStorage.setItem('palettePreset', paletteId);
      applyThemeTo3D();
      debug.log('Palette applied', { palette: paletteId, colors: [n1, n2, n3] });
    }

    function applyGeometry(geoId){
      setGeometry(geoId);
      localStorage.setItem('geoPreset', geoId);
      debug.log('Geometry applied', { geometry: geoId });
    }

    // Design panel functionality - FIXED
    document.getElementById('themeFab').addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const panel = document.getElementById('themePanel');
        panel.classList.toggle('open');
        debug.log('Theme panel toggled', { isOpen: panel.classList.contains('open') });
    });

    // Close panel when clicking outside
    document.addEventListener('click', function(e) {
        const panel = document.getElementById('themePanel');
        const fab = document.getElementById('themeFab');
        if (panel.classList.contains('open') && !panel.contains(e.target) && e.target !== fab) {
            panel.classList.remove('open');
            debug.log('Theme panel closed via outside click');
        }
    });
    
    document.getElementById('closeTheme').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('themePanel').classList.remove('open');
        debug.log('Theme panel closed via close button');
    });

    themeGrid.addEventListener('click', (e)=>{ 
      const el = e.target.closest('[data-palette]'); 
      if(!el) return; 
      applyPalette(el.dataset.palette); 
    });
    
    geoGrid.addEventListener('click', (e)=>{ 
      const el = e.target.closest('[data-geo]');     
      if(!el) return; 
      applyGeometry(el.dataset.geo); 
    });

    // Persist lock background
    lockBg.checked = localStorage.getItem('lockBg') === '1';
    lockBg.addEventListener('change', ()=>{ 
      localStorage.setItem('lockBg', lockBg.checked ? '1':'0'); 
      debug.log('Lock background setting changed', { locked: lockBg.checked });
    });

    // Initial presets
    const savedPalette = localStorage.getItem('palettePreset');
    const savedGeo = localStorage.getItem('geoPreset');
    applyPalette(savedPalette || 'silver-violet');
    applyGeometry(savedGeo || 'icosa');

    // === Background music - FIXED ===
    const audioBtn = document.getElementById('audioBtn');
    const bgTrack = document.getElementById('bgTrack');
    let playing = false;

    function tryAutoplay(){
      if(playing) return;
      bgTrack.volume = 0.3;
      const playPromise = bgTrack.play();
      if (playPromise !== undefined) {
        playPromise.then(() => { 
          playing = true; 
          audioBtn.setAttribute('aria-pressed','true');
          audioBtn.innerHTML = '♪ ' + (i18n[lang]?.ui?.music || 'Music');
          updateProgress('Музыка загружена');
          debug.log('Background music autoplay successful');
        }).catch((e) => { 
          console.log('Autoplay failed:', e);
          debug.warn('Background music autoplay failed', { error: e });
          // Show play button to allow user interaction
          audioBtn.style.display = 'block';
        });
      }
    }

    // Enable autoplay on any user interaction
    ['click', 'keydown', 'touchstart', 'scroll'].forEach(event => {
      document.addEventListener(event, tryAutoplay, { once: true });
    });

    audioBtn.addEventListener('click', function(e){
      e.preventDefault();
      e.stopPropagation();
      if(!playing){ 
        bgTrack.play().then(() => { 
          playing = true; 
          audioBtn.setAttribute('aria-pressed','true');
          audioBtn.innerHTML = '♪ ' + (i18n[lang]?.ui?.music || 'Music');
          debug.log('Background music started manually');
        }).catch(e => {
          console.log('Play failed:', e);
          debug.error('Background music play failed', { error: e });
        }); 
      } else { 
        bgTrack.pause(); 
        playing = false; 
        audioBtn.setAttribute('aria-pressed','false');
        audioBtn.innerHTML = '♪ ' + (i18n[lang]?.ui?.music || 'Music');
        debug.log('Background music paused');
      }
    });

    // Final loading completion
    setTimeout(() => {
      updateProgress('Сайт готов!');
      debug.log('Website fully loaded and initialized');
    }, 3300);

    // Регистрация Service Worker для офлайн-функциональности
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(registration => {
          console.log('SW registered: ', registration);
          debug.log('Service Worker registered successfully', { registration: registration });
        }).catch(registrationError => {
          console.log('SW registration failed: ', registrationError);
          debug.error('Service Worker registration failed', { error: registrationError });
        });
      });
    }

    // === DEBUG CONTROLS ===
    // Add debug info to console on startup
    debug.log('=== WOW PORTFOLIO DEBUG SYSTEM STARTED ===');
    debug.log('Navigation system ready - all links should work properly now');
    debug.log('Use debug.log(), debug.warn(), debug.error() for logging');
  </script>
</body>
</html>
